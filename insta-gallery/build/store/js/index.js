(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var c in s)e.o(s,c)&&!e.o(t,c)&&Object.defineProperty(t,c,{enumerable:!0,get:s[c]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{FIRST_WP_VERSION_WITH_THUNK_SUPPORT:()=>F,INITIAL_STATE:()=>i,STORE_NAME:()=>r,WP_VERSION:()=>_,actions:()=>c,apiFetch:()=>b,applyThunkMiddleware:()=>k,clearFeedCache:()=>A,fetchRestApiAccounts:()=>m,fetchRestApiFeeds:()=>R,fetchRestApiSettings:()=>O,fetchRestApiUserProfile:()=>w,isVersionLessThan:()=>P,reducer:()=>s,resolvers:()=>n,selectors:()=>a,storeConfig:()=>B,useAccountsEntities:()=>E,useFeedsEntities:()=>T,useSettingsEntities:()=>N});var s={};e.r(s),e.d(s,{accounts:()=>d,default:()=>g,feeds:()=>u,settings:()=>l});var c={};e.r(c),e.d(c,{createAccount:()=>D,createFeed:()=>M,deleteAccount:()=>q,deleteFeed:()=>U,editFeed:()=>L,saveSettings:()=>V,setAccounts:()=>j,setFeeds:()=>I,setSettings:()=>C});var a={};e.r(a),e.d(a,{getAccounts:()=>W,getFeeds:()=>G,getSettings:()=>H});var n={};e.r(n),e.d(n,{getAccounts:()=>x,getFeeds:()=>K,getSettings:()=>z});const o=window.wp.data,r="qligg",i={accounts:{},feeds:[],settings:{}};function d(e=i.accounts,t){return"SET_ACCOUNTS"===t.type?t.payload:e}function u(e=i.feeds,t){return"SET_FEEDS"===t.type?t.payload:e}function l(e=i.settings,t){return"SET_SETTINGS"===t.type?t.payload:e}const g=(0,o.combineReducers)({accounts:d,feeds:u,settings:l}),h=window.lodash,p=window.wp.i18n,S=window.wp.notices,y=window.wp.apiFetch;var f=e.n(y);const v=qligg_store_routes,{WP_VERSION:_}=qligg_store,F="6.0";async function b(e){return f()(e).then((e=>(e.code,e))).catch((e=>{throw new Error(e)}))}const R=({method:e,data:t}={})=>b({path:v.feeds,method:e,data:t});function T(){const{createFeed:e,editFeed:t,deleteFeed:s}=(0,o.useDispatch)(r),{feeds:c,isResolvingFeeds:a,hasResolvedFeeds:n}=(0,o.useSelect)((e=>{const{isResolving:t,hasFinishedResolution:s,getFeeds:c}=e(r);return{feeds:Object.values(c()),isResolvingFeeds:t("getFeeds"),hasResolvedFeeds:s("getFeeds")}}),[]);return{feeds:c,isResolvingFeeds:a,hasResolvedFeeds:n,hasFeeds:!(!n||!Object.keys(c)?.length),createFeed:e,editFeed:t,deleteFeed:s}}function A({method:e,data:t}){return b({path:v.cache,method:e,data:t})}const m=({method:e,data:t}={})=>b({path:v.accounts,method:e,data:t}),w=({method:e,data:t})=>b({path:v.userProfile,method:e,data:t});function E(){const{createAccount:e,deleteAccount:t}=(0,o.useDispatch)(r),{accounts:s,isResolvingAccounts:c,hasResolvedAccounts:a}=(0,o.useSelect)((e=>{const{isResolving:t,hasFinishedResolution:s,getAccounts:c}=e(r);return{accounts:Object.values(c()),isResolvingAccounts:t("getAccounts"),hasResolvedAccounts:s("getAccounts")}}),[]);return{accounts:s,isResolvingAccounts:c,hasResolvedAccounts:a,hasAccounts:!(!a||!Object.keys(s)?.length),createAccount:e,deleteAccount:t}}const O=({method:e,data:t}={})=>b({path:v.settings,method:e,data:t});function N(){const{saveSettings:e}=(0,o.useDispatch)(r),{settings:t,isResolvingSettings:s,hasResolvedSettings:c}=(0,o.useSelect)((e=>{const{isResolving:t,hasFinishedResolution:s,getSettings:c}=e(r);return{settings:c(),isResolvingSettings:t("getSettings"),hasResolvedSettings:s("getSettings")}}),[]);return{settings:t,isResolvingSettings:s,hasResolvedSettings:c,hasSettings:!(!c||!Object.keys(t)?.length),saveSettings:e}}const P=(e,t)=>{const s=e.split(".").map(Number),c=t.split(".").map(Number);for(let e=0;e<c.length;e++){if(s[e]<c[e])return!0;if(s[e]>c[e])return!1}return!1},k=e=>{const t=e.instantiate;return e.instantiate=e=>{const s=t(e);if(!s.store||!s.store.dispatch)throw new Error((0,p.__)("The created instance does not contain a valid store.","insta-gallery"));const c=s.store.dispatch,a=((e,t)=>({registry:t,get dispatch(){return Object.assign((t=>e.store.dispatch(t)),e.getActions())},get select(){return Object.assign((t=>t(e.store.__unstableOriginalGetState())),e.getSelectors())},get resolveSelect(){return e.getResolveSelectors()}}))(s,e);return s.store.dispatch=((e,t)=>s=>"function"==typeof s?s(e):t(s))(a,c),s},e},j=e=>({type:"SET_ACCOUNTS",payload:e}),I=e=>({type:"SET_FEEDS",payload:e}),C=e=>({type:"SET_SETTINGS",payload:e}),D=e=>async({registry:t,dispatch:s,select:c})=>{const a=await m({method:"POST",data:e});if(a?.code)return t.dispatch(S.store).createSuccessNotice((0,p.sprintf)("%s: %s",a.code,a.message),{type:"snackbar"}),!1;const n=c.getAccounts();return s.setAccounts({...n,[a.id]:a}),t.dispatch(S.store).createSuccessNotice((0,p.__)("The account has been updated successfully.","insta-gallery"),{type:"snackbar"}),!0},q=e=>async({registry:t,dispatch:s,select:c})=>{const a=await m({method:"DELETE",data:{id:e}});if(a?.code)return t.dispatch(S.store).createSuccessNotice((0,p.sprintf)("%s: %s",a.code,a.message),{type:"snackbar"}),!1;const n=c.getAccounts(),o=(0,h.filter)(n,(t=>t.id!==e));return s.setAccounts({...o}),t.dispatch(S.store).createSuccessNotice((0,p.sprintf)((0,p.__)("The account %s has been deleted.","insta-gallery"),e),{type:"snackbar"}),!0},M=e=>async({registry:t,dispatch:s,select:c})=>{const a=await R({method:"POST",data:{feed:e}});if(a?.code)return t.dispatch(S.store).createSuccessNotice((0,p.sprintf)("%s: %s",a.code,a.message),{type:"snackbar"}),!1;const n=c.getFeeds();return n.push(a),s.setFeeds([...n]),t.dispatch(S.store).createSuccessNotice((0,p.__)("The feed has been created successfully.","insta-gallery"),{type:"snackbar"}),!0},U=e=>async({registry:t,dispatch:s,select:c})=>{const a=await R({method:"DELETE",data:{feed_settings:e}});if(a?.code)return t.dispatch(S.store).createSuccessNotice((0,p.sprintf)("%s: %s",a.code,a.message),{type:"snackbar"}),!1;const n=c.getFeeds().filter((t=>t.id!==e.id));return s.setFeeds([...n]),t.dispatch(S.store).createSuccessNotice((0,p.sprintf)((0,p.__)("The feed %s has been deleted.","insta-gallery"),e.id),{type:"snackbar"}),!0},L=e=>async({registry:t,dispatch:s,select:c})=>{const a=await R({method:"PATCH",data:{feed:e}});if(a?.code)return t.dispatch(S.store).createSuccessNotice((0,p.sprintf)("%s: %s",a.code,a.message),{type:"snackbar"}),!1;const n=c.getFeeds();return s.setFeeds([...n.map((t=>t.id===e.id?e:t))]),t.dispatch(S.store).createSuccessNotice((0,p.__)("The feed has been updated successfully.","insta-gallery"),{type:"snackbar"}),!0},V=e=>async({registry:t,dispatch:s})=>{const c=await O({method:"POST",data:e});return c?.code?(t.dispatch(S.store).createSuccessNotice((0,p.sprintf)("%s: %s",c.code,c.message),{type:"snackbar"}),!1):(s.setSettings({...e}),t.dispatch(S.store).createSuccessNotice((0,p.__)("Settings saved.","insta-gallery"),{type:"snackbar"}),!0)},W=(e,t)=>t&&e.accounts[t]?e.accounts[t]:e.accounts,G=(e,t)=>t&&e.feeds[t]?e.feeds[t]:e.feeds,H=e=>e.settings,x=async()=>{try{const e=await m(),t=Object.values(e),s=await Promise.all(t.map((async e=>{let t={};try{t=await w({method:"POST",data:{feedSettings:{account_id:e.id}}})}catch(e){console.log(e)}return delete t.id,{...e,...t}})));return j(s)}catch(e){console.error(e)}},K=async()=>{try{const e=await R();return I(Object.values(e))}catch(e){console.error(e)}},z=async()=>{try{const e=await O();return C(e)}catch(e){console.error(e)}},B={reducer:g,actions:c,selectors:a,resolvers:n},J=(0,o.createReduxStore)(r,B);(0,o.register)(P(_,F)?k(J):J),(window.qligg=window.qligg||{}).store=t})();