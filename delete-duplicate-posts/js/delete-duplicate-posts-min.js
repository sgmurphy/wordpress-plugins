"use strict";jQuery(document).ready((function($){n();var e=jQuery("#ddp_redirtable").DataTable({processing:!0,serverSide:!0,autoWidth:!0,ordering:!0,ajax:{url:ajaxurl,type:"POST",data:function(e){return jQuery.extend({},e,{action:"ddp_get_redirects",_ajax_nonce:cp_ddp.nonce})},dataSrc:function(e){return e.data}},columns:[{data:"ID",visible:!1},{data:"from_url",title:"From URL"},{data:"target_url",title:"Target URL"}],select:{style:"multi"},dom:'<"top"Blfip>rt<"bottom"Blfip>',buttons:[{text:"Refresh",action:function(e,t,a,r){var o=$(a);o.prop("disabled",!0).text("Refreshing..."),t.ajax.reload((function(){o.prop("disabled",!1).text("Refresh")}))},className:"button button-secondary button-small"}],pageLength:10,rowCallback:function(e,t){jQuery(e).addClass("wp-list-table widefat fixed striped table-view-list")},lengthMenu:[[10,25,50,100,250,500],[10,25,50,100,250,500]]});e.on("error.dt",(function(e,t,a,r){e.preventDefault(),console.error("RedirectsDataTables error:",r,"TechNote:",a);var o="Error details: "+r+(a?" (Tech note: "+a+")":"");jQuery("#ddp-dashboard .errormessage").html("Redirects DataTables error occurred. "+o).show()})),e.buttons().container().appendTo("#ddp_redirtable_wrapper .top");var t=jQuery("#ddp_dupetable").DataTable({select:{style:"multi"},autoWidth:!0,processing:!0,language:{processing:'<div id="processingMessage">Looking for duplicates</div>'},serverSide:!0,searching:!1,ordering:!1,dom:'<"top"lip>rt<"bottom"ip><"clear">',ajax:{url:ajaxurl,type:"POST",data:function(e){return jQuery.extend({},e,{action:"ddp_get_duplicates",_ajax_nonce:cp_ddp.nonce})},dataSrc:function(e){return e.error?(jQuery("#ddp-dashboard .errormessage").html(e.error).show(),[]):e.data},beforeSend:function(){startTime=(new Date).getTime(),jQuery("#requestTime").html("Request: 0 sec."),interval=setInterval(s,1e3),jQuery("#ddp_dupetable .dt-button").prop("disabled",!0),jQuery("#ddp_dupetable tbody").css("opacity","0.5")},complete:function(){clearInterval(interval),jQuery("#ddp_dupetable tbody").css("opacity","1"),jQuery("#ddp_dupetable .dt-button").prop("disabled",!1),n()},error:function(e,t,a){console.error("AJAX error:",t,a);var r="Status: "+t+", Error: "+a+", Response: "+e.responseText;return jQuery("#ddp-dashboard .errormessage").html("Failed to load data. "+r).show(),[]}},columns:[{data:"ID",visible:!1},{data:"orgID",visible:!1},{data:"duplicate",title:"Duplicate",orderable:!1},{data:"original",title:"Original",orderable:!1}],rowCallback:function(e){jQuery(e).addClass("wp-list-table widefat fixed striped table-view-list")},lengthMenu:[[10,25,50,100,250,500],[10,25,50,100,250,500]]});function a(){t.ajax.reload()}function r(){var e=t.rows({selected:!0}).data();if(0!==e.length){if(confirm(cp_ddp.text_areyousure)){var a=[];jQuery.each(e,(function(e,t){a.push({ID:t.ID,orgID:t.orgID})})),jQuery.ajax({type:"POST",url:ajaxurl,data:{_ajax_nonce:cp_ddp.deletedupes_nonce,action:"ddp_delete_duplicates",checked_posts:a},success:function(e){if(e.success)t.ajax.reload(null,!1),n();else{var a=e.data&&e.data.message?e.data.message:"Unknown error occurred";alert("Response from the server: "+a)}},error:function(e,t,a){alert("An error occurred: "+t)}})}}else alert("Please select at least one row to delete.")}function o(){t.rows({page:"current"}).select()}function d(){t.rows().deselect()}function s(){var e=((new Date).getTime()-startTime)/1e3;jQuery("#requestTime").html("Request: "+e+" sec."),jQuery("#processingMessage").html("Looking for duplicates "+e+" sec.")}function n(){jQuery("#ddp_log").empty(),jQuery.ajax({type:"POST",url:ajaxurl,data:{_ajax_nonce:cp_ddp.loglines_nonce,action:"ddp_get_loglines"},dataType:"json",success:function(e){let t=e.data.results;t&&jQuery.each(t,(function(e,t){jQuery("#ddp_log").append("<li><code>"+t.datime+"</code> "+t.note+"</li>")})),jQuery("#log .spinner").removeClass("is-active")}}).fail((function(e){jQuery("#log .spinner").removeClass("is-active"),window.console&&window.console.log&&window.console.log(e.statusCode+" "+e.statusText)}))}function l(e,t,a){jQuery.ajax({type:"POST",url:ajaxurl,data:{_ajax_nonce:cp_ddp.nonce,action:"ddp_get_duplicates",stepid:e},dataType:"json",success:function(e){let r=e.data.dupes;r?(jQuery("#ddp_container #dashboard .statusdiv .statusmessage").html(e.data.msg).show(),jQuery("#ddp_container #dashboard .statusdiv .dupelist .duplicatetable").show(),jQuery.each(r,(function(e,t){jQuery("#ddp_container #dashboard .statusdiv .dupelist .duplicatetable tbody").append('<tr><th scope="row" class="check-column"><label class="screen-reader-text" for="cb-select-'+t.ID+'">Select Post</label><input id="cb-select-'+t.ID+'" type="checkbox" name="delpost[]" value="'+t.ID+'" data-orgid="'+t.orgID+'"><div class="locked-indicator"></div></th><td><a href="'+t.permalink+'" target="_blank">'+t.title+"</a> (ID #"+t.ID+" type:"+t.type+" status:"+t.status+')</td><td><a href="'+t.orgpermalink+'" target="_blank">'+t.orgtitle+"</a> (ID #"+t.orgID+") "+t.why+"</td></tr>")})),jQuery("#ddp_container #dashboard .statusdiv .dupelist .duplicatetable tbody").slideDown()):jQuery("#ddp_container #dashboard .statusdiv .statusmessage").html(e.data.msg).show(),"-1"==e.data.nextstep?jQuery("#ddp_container #dashboard .statusdiv .errormessage").text("Something went wrong.").show():parseInt(e.data.nextstep)>0&&l(parseInt(e.data.nextstep),t,a)}}).fail((function(e){window.console&&window.console.log&&window.console.log(e.statusCode+" "+e.statusText)}))}t.on("error.dt",(function(e,t,a,r){e.preventDefault(),console.error("DataTables error:",r,"TechNote:",a);var o="Error details: "+r+(a?" (Tech note: "+a+")":"");jQuery("#ddp-dashboard .errormessage").html("DataTables error occurred. "+o).show()})),$.fn.dataTable.ext.errMode="none",function(){var e=jQuery("<div/>",{class:"dt-buttons"});return e.append(jQuery("<button/>",{text:"Refresh",click:a,class:"dt-button button button-secondary button-small"})),e.append(jQuery("<button/>",{text:"Delete Selected",click:r,class:"dt-button button button-secondary button-small ddp-delete-selected"})),e.append(jQuery("<button/>",{text:"Select Visible",click:o,class:"dt-button button button-secondary button-small"})),e.append(jQuery("<button/>",{text:"Select None",click:d,class:"dt-button button button-secondary button-small"})),e}().insertBefore("#ddp_dupetable_paginate"),jQuery("#ddp_dupetable tbody").on("click","tr",(function(){jQuery(this).toggleClass("selected")})),jQuery(document).on("click","#deleteduplicateposts_resetview",(function(e){e.preventDefault(),jQuery("#ddp_container .dupelist .duplicatetable tbody").empty(),l(1,senddata),n()})),jQuery(document).on("click",".ddpcomparemethod li",(function(){jQuery(".ddpcomparemethod input:radio").each((function(){this.checked?jQuery(this).closest("li").find(".ddp-compare-details").show():jQuery(this).closest("li").find(".ddp-compare-details").hide()}))})),jQuery(".ddpcomparemethod li").trigger("click")}));