(()=>{var e={428:e=>{"use strict";e.exports=window.jQuery},86:e=>{"use strict";e.exports=window.wc_stripe},475:e=>{e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},383:e=>{e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},579:(e,t,r)=>{var o=r(736);function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,o(n.key),n)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},693:(e,t,r)=>{var o=r(736);e.exports=function(e,t,r){return(t=o(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.__esModule=!0,e.exports.default=e.exports},395:(e,t,r)=>{var o=r(552);function n(){return"undefined"!=typeof Reflect&&Reflect.get?(e.exports=n=Reflect.get.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=n=function(e,t,r){var n=o(e,t);if(n){var s=Object.getOwnPropertyDescriptor(n,t);return s.get?s.get.call(arguments.length<3?e:r):s.value}},e.exports.__esModule=!0,e.exports.default=e.exports),n.apply(this,arguments)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},72:e=>{function t(r){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},511:(e,t,r)=>{var o=r(636);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&o(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},994:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},452:(e,t,r)=>{var o=r(738).default,n=r(475);e.exports=function(e,t){if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return n(e)},e.exports.__esModule=!0,e.exports.default=e.exports},636:e=>{function t(r,o){return e.exports=t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r,o)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},552:(e,t,r)=>{var o=r(72);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e},e.exports.__esModule=!0,e.exports.default=e.exports},45:(e,t,r)=>{var o=r(738).default;e.exports=function(e,t){if("object"!=o(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},736:(e,t,r)=>{var o=r(738).default,n=r(45);e.exports=function(e){var t=n(e,"string");return"symbol"==o(t)?t:t+""},e.exports.__esModule=!0,e.exports.default=e.exports},738:e=>{function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,r),s.exports}(()=>{var e=r(994),t=e(r(693)),o=e(r(383)),n=e(r(579)),s=e(r(452)),a=e(r(395)),i=e(r(72)),u=e(r(511)),c=e(r(428)),p=r(86);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function _(e){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?l(Object(o),!0).forEach((function(r){(0,t.default)(e,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):l(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function f(e,t,r){return t=(0,i.default)(t),(0,s.default)(e,d()?Reflect.construct(t,r||[],(0,i.default)(e).constructor):t.apply(e,r))}function d(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(d=function(){return!!e})()}function y(e){p.BaseGateway.call(this,e),p.CheckoutGateway.call(this)}Object.assign(y.prototype,p.BaseGateway.prototype,p.CheckoutGateway.prototype),new(function(e){function t(e){var r;return(0,o.default)(this,t),(r=f(this,t,[e])).handle_create_account_change(),r}return(0,u.default)(t,e),(0,n.default)(t,[{key:"initialize",value:function(){window.addEventListener("hashchange",this.hashchange.bind(this)),(0,c.default)(document.body).on("payment_method_selected",this.payment_method_selected.bind(this)),(0,c.default)(document.body).on("click","#place_order",this.on_order_pay.bind(this)),(0,c.default)(document.body).on("change","#createaccount",this.handle_create_account_change.bind(this))}},{key:"updated_checkout",value:function(){this.handle_create_account_change()}},{key:"checkout_place_order",value:function(){return this.payment_token_received=!0,(0,a.default)((0,i.default)(t.prototype),"checkout_place_order",this).call(this)}},{key:"on_order_pay",value:function(e){var t=this;if(this.is_gateway_selected())if(this.is_change_payment_method()){var r=this.params,o=r.order_id,n=r.order_key;e.preventDefault(),this.create_setup_intent({order_id:o,order_key:n}).then((function(e){var r=e.setup_intent;t.handle_payment_method_setup({order_id:o,order_key:n,client_secret:r.client_secret})}))}else this.is_current_page("order_pay")&&(e.preventDefault(),this.process_order_pay())}},{key:"handle_next_action",value:function(e){var t=this,r=e.client_secret;this.stripe.collectBankAccountForPayment({clientSecret:r,params:{payment_method_type:"us_bank_account",payment_method_data:{billing_details:{name:this.get_customer_name(this.get_billing_prefix()),email:this.fields.get("billing_email",null)}}}}).then((function(r){var o=r.paymentIntent,n=r.error;if(n)return t.submit_error(n);"requires_confirmation"===o.status?t.do_payment_confirmation(e):t.cancel_payment_processing()}))}},{key:"handle_payment_method_setup",value:function(e){var t=this,r=e.client_secret;this.stripe.collectBankAccountForSetup({clientSecret:r,params:{payment_method_type:"us_bank_account",payment_method_data:{billing_details:{name:this.get_customer_name(this.get_billing_prefix()),email:this.fields.get("billing_email",null)}}}}).then((function(r){var o=r.setupIntent,n=r.error;if(n)return t.submit_error(n);"requires_confirmation"===o.status?t.do_setup_confirmation(e):t.cancel_payment_processing()}))}},{key:"do_payment_confirmation",value:function(e){var t=this,r=e.client_secret,o=e.order_id,n=e.order_key;this.stripe.confirmUsBankAccountPayment(r).then((function(e){var r=e.paymentIntent,s=e.error;if(s)return t.submit_error(s);if("requires_payment_method"===r.status)t.cancel_payment_processing();else{if("requires_action"===r.status)return t.cancel_payment_processing(),t.submit_error({code:"ach_instant_only"});"processing"===r.status&&(t.set_nonce(r.payment_method),t.is_current_page("order_pay")?t.get_form().trigger("submit"):t.process_payment(o,n))}}))}},{key:"do_setup_confirmation",value:function(e){var t=this,r=e.client_secret,o=e.order_id,n=e.order_key;this.stripe.confirmUsBankAccountSetup(r).then((function(e){var r=e.setupIntent,s=e.error;if(s)return t.submit_error(s);if("requires_payment_method"===r.status)t.cancel_payment_processing();else{if("requires_action"===r.status)return t.cancel_payment_processing(),t.submit_error({code:"ach_instant_only"});"succeeded"===r.status&&(t.set_nonce(r.payment_method),t.is_current_page("order_pay")||t.is_change_payment_method()?t.get_form().trigger("submit"):t.process_payment(o,n))}}))}},{key:"hide_place_order",value:function(){}},{key:"show_payment_button",value:function(){this.show_place_order()}},{key:"cancel_payment_processing",value:function(){var e;(0,c.default)(this.container).closest("form").removeClass("processing"),null===(e=(0,c.default)(this.container).closest("form"))||void 0===e||e.unblock()}},{key:"fees_enabled",value:function(){return"1"==this.params.fees_enabled}},{key:"payment_method_selected",value:function(){this.fees_enabled()&&(0,c.default)(document.body).trigger("update_checkout")}},{key:"create_setup_intent",value:function(e){var t=this;return new Promise((function(r,o){c.default.ajax({method:"POST",dataType:"json",data:_({payment_method:t.gateway_id},e),url:t.params.routes.base_path.replace("%s","wc-stripe/v1/subscriptions/setup-intent"),beforeSend:t.ajax_before_send.bind(t)}).done((function(e){e.code?o(e.message):r(e)})).fail((function(e,r,o){t.submit_error(o)}))}))}}])}(y))(wc_stripe_ach_connections_params)})()})();
//# sourceMappingURL=ach-connections.js.map