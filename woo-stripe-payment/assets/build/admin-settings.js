(()=>{"use strict";var e={};function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var i=o.call(e,"string");if("object"!=t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}function o(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,n(i.key),i)}}e.n=t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},e.d=(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const i=window.jQuery;var a=e.n(i),r=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.params=t,this.prefix="#"+a()("#wc_stripe_prefix").val()},(t=[{key:"init",value:function(){a()('[name^="woocommerce_stripe"]').on("change",this.display_children.bind(this)),a()("select.stripe-accepted-cards").on("select2:select",this.reorder_multiselect),a()(".api-register-domain").on("click",this.register_domain.bind(this)),a()(".wc-stripe-create-webhook").on("click",this.manage_webhook.bind(this)),a()(".wc-stripe-connection-test").on("click",this.do_connection_test.bind(this)),a()(".stripe-delete-connection").on("click",this.do_delete_connection.bind(this)),a()(document.body).on("change",".payment-method-config-options",this.fetchPaymentMethodConfigSettings.bind(this)),a()(document.body).on("click",".add-new-payment-config",this.renderPaymentConfigModal.bind(this)),a()(document.body).on("click","#create-payment-config",this.createPaymentMethodConfig.bind(this)),a()(document.body).on("click",".refresh-payment-config",this.refreshPaymentConfig.bind(this)),"undefined"!=typeof wc_stripe_admin_notices&&this.display_notices(),this.display_children(),window.location.search.match(/_stripe_connect_nonce/)&&history.pushState({},"",window.location.pathname+"?page=wc-settings&tab=checkout&section=stripe_api"),a()(document.body).on("submit","#mainform",this.validateForm.bind(this))}},{key:"display_children",value:function(e){a()("[data-show-if]").each(function(e,t){var n=a()(t),o=n.data("show-if"),i=[];a().each(o,function(e,t){var o=a()(this.prefix+e);-1==i.indexOf(n.attr("id"))?o.is(":checkbox")?o.is(":checked")==t?n.closest("tr").show():(n.closest("tr").hide(),i.push(n.attr("id"))):o.val()==t?n.closest("tr").show():(n.closest("tr").hide(),i.push(n.attr("id"))):(n.closest("tr").hide(),i.push(n.attr("id")))}.bind(this))}.bind(this))}},{key:"reorder_multiselect",value:function(e){var t=e.params.data.element,n=a()(t);n.detach(),a()(this).append(n),a()(this).trigger("change")}},{key:"register_domain",value:function(e){var t=this;e.preventDefault(),this.block(),a().ajax({url:this.params.routes.apple_domain,dataType:"json",method:"POST",data:{_wpnonce:this.params.rest_nonce,hostname:window.location.hostname}}).done((function(e){t.unblock(),e.code,window.alert(e.message)})).fail((function(e,n,o){t.unblock(),window.alert(o)}))}},{key:"manage_webhook",value:function(e){e.preventDefault(),a()(e.currentTarget).is(".wc-stripe-delete-webhook")?this.delete_webhook():this.create_webhook()}},{key:"create_webhook",value:function(){var e=this;this.block();var t=a()("#woocommerce_stripe_api_mode").val();a().ajax({url:this.params.routes.create_webhook,dataType:"json",method:"POST",data:{_wpnonce:this.params.rest_nonce,environment:t}}).done((function(n){e.unblock(),n.code?window.alert(n.message):(a()("#woocommerce_stripe_api_webhook_secret_"+t).val(n.secret),window.alert(n.message),window.location.reload())})).fail((function(t,n,o){e.unblock(),window.alert(o)}))}},{key:"delete_webhook",value:function(){this.block();var e=a()("#woocommerce_stripe_api_mode").val();a().ajax({url:this.params.routes.delete_webhook,dataType:"json",method:"POST",data:{_wpnonce:this.params.rest_nonce,mode:e}}).done(function(t){this.unblock(),t.code?window.alert(t.message):(a()("#woocommerce_stripe_api_webhook_secret_"+e).val(""),window.location.reload())}.bind(this)).fail(function(e,t,n){this.unblock(),window.alert(n)}.bind(this))}},{key:"do_connection_test",value:function(e){var t=this;e.preventDefault(),this.block();var n,o=a()("#woocommerce_stripe_api_mode").val();a().ajax({url:this.params.routes.connection_test,dataType:"json",method:"POST",data:(n={_wpnonce:t.params.rest_nonce,mode:o},"test"===o&&(n.secret_key=a()("#woocommerce_stripe_api_secret_key_test").val(),n.publishable_key=a()("#woocommerce_stripe_api_publishable_key_test").val()),n)}).done((function(e){t.unblock(),e.code,window.alert(e.message)})).fail((function(e,n,o){t.unblock(),window.alert(o)}))}},{key:"display_notices",value:function(){a().each(wc_stripe_admin_notices,function(e,t){a()(".woo-nav-tab-wrapper").after(t)}.bind(this))}},{key:"block",value:function(){a()(".wc-stripe-settings-container").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})}},{key:"unblock",value:function(){a()(".wc-stripe-settings-container").unblock()}},{key:"do_delete_connection",value:function(e){e.preventDefault(),confirm(this.params.messages.delete_connection)&&(this.block(),a().ajax({method:"POST",url:this.params.routes.delete_connection,dataType:"json",data:{_wpnonce:this.params.rest_nonce}}).done(function(e){this.unblock(),e.code?window.alert(e.message):window.location.reload()}.bind(this)).fail(function(){this.unblock()}.bind(this)))}},{key:"createPaymentMethodConfig",value:function(e){e.preventDefault();var t=a()(e.currentTarget),n=t.text();t.text(this.params.messages.create).prop("disabled",!0),a().ajax({method:"POST",url:this.params.routes.create_payment_method_config,dataType:"json",data:{_wpnonce:this.params.rest_nonce,name:a()("#payment_config_name").val()}}).done((function(e){t.text(n).prop("disabled",!1),e.code?window.alert(e.message):(a()(".wc-stripe-settings-container").replaceWith(e.html),a()(document.body).trigger("wc-enhanced-select-init"),a()(".modal-close").click())})).fail((function(){t.text(n).prop("disabled",!1)}))}},{key:"fetchPaymentMethodConfigSettings",value:function(e){var t=this;this.block();var n=a()("#woocommerce_stripe_upm_enabled").is(":checked");a().ajax({method:"POST",url:this.params.routes.fetch_payment_method_config,dataType:"json",data:{_wpnonce:this.params.rest_nonce,payment_config:a()(e.currentTarget).val()}}).done((function(e){t.unblock(),e.code?window.alert(e.message):(a()(".wc-stripe-settings-container").replaceWith(e.html),a()("#woocommerce_stripe_upm_enabled").prop("checked",n),a()(document.body).trigger("wc-enhanced-select-init"),a()(".modal-close").click())})).fail((function(){t.unblock()}))}},{key:"renderPaymentConfigModal",value:function(e){e.preventDefault(),a()(e.currentTarget).WCBackboneModal({template:"wc-stripe-modal-payment-config",variable:""})}},{key:"validateForm",value:function(e){if(a()(".wc-stripe-settings-container").hasClass("stripe_upm")&&""===a()(".payment-method-config-options").val())return window.alert(this.params.messages.upm_validation),!1}},{key:"refreshPaymentConfig",value:function(e){e.preventDefault();var t=a()(e.currentTarget);t.prop("disabled",!0).find("span").addClass("processing"),a().ajax({method:"POST",url:this.params.routes.refresh_payment_method_config,dataType:"json",data:{_wpnonce:this.params.rest_nonce,payment_config:a()(e.currentTarget).val()}}).done((function(e){t.prop("disabled",!1).find("span").removeClass("processing"),e.code?window.alert(e.message):(a()(".wc-stripe-settings-container").replaceWith(e.html),a()(document.body).trigger("wc-enhanced-select-init"))})).fail((function(){t.prop("disabled",!1).find("span").removeClass("processing")}))}}])&&o(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();a()((function(){new r(wc_stripe_setting_params).init()}))})();
//# sourceMappingURL=admin-settings.js.map