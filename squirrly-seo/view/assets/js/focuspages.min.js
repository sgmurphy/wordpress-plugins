(function($){"use strict";$.fn.sq_focusPages=function(){var $this=this;var lastScrollLeft=0;var scrollLeft=0;var maxScrollLeft=0;$this.listenScrollbar=function(){$this.find(".sq_overflow").css("max-width",$(window).width()-$(".sq_nav").width()-$(".sq_col_side").width()-49).show();$(".sq_nav_item_open, .sq_nav_item_collapse").on("click",function(){$this.find(".sq_overflow").hide().css("max-width",$(window).width()-$(".sq_nav").width()-$(".sq_col_side").width()-49).show()});$(window).resize(function(){$this.find(".sq_overflow").hide().css("max-width",$(window).width()-$(".sq_nav").width()-$(".sq_col_side").width()-49).show();maxScrollLeft=$this.find(".sq_overflow").prop("scrollWidth")-$this.find(".sq_overflow").width()});$this.find(".sq_overflow_arrow_right").show();$this.find(".sq_overflow_arrow_right").off().on("click",function(){if($.isFunction($this.find(".sq_overflow").animate)){$this.find(".sq_overflow").animate({scrollLeft:scrollLeft+400},500)}else{$this.find(".sq_overflow").scrollLeft(scrollLeft+400)}$(".sq_overflow_arrow_left").show()});$this.find(".sq_overflow_arrow_left").off().on("click",function(){if($.isFunction($this.find(".sq_overflow").animate)){$this.find(".sq_overflow").animate({scrollLeft:scrollLeft-400},500)}else{$this.find(".sq_overflow").scrollLeft(scrollLeft-400)}$(".sq_overflow_arrow_right").show()});$this.find(".sq_overflow").scroll(function(){$(".sq_overflow_arrow_right").show();$(".sq_overflow_arrow_left").show();scrollLeft=parseInt($this.find(".sq_overflow").scrollLeft());maxScrollLeft=$this.find(".sq_overflow").prop("scrollWidth")-$this.find(".sq_overflow").width();if(lastScrollLeft!==scrollLeft){if(scrollLeft===0){$(".sq_overflow_arrow_right").show();$(".sq_overflow_arrow_left").hide()}else if(scrollLeft>=maxScrollLeft-20){$(".sq_overflow_arrow_right").hide();$(".sq_overflow_arrow_left").show()}lastScrollLeft=scrollLeft}})};var sq_Assistant=$.fn.sq_Assistant;$.fn.sq_Assistant=function(options){var $this=this;var $modal=$("#sq_assistant_modal");var settings=$.extend({category:"metas"},options);if($(".sq_focuspages_content").find(".sq_assistant").length>0){$(".sq_focuspages_assistant").html($(".sq_focuspages_content").find(".sq_assistant"))}$this.listenTableBullets=function(){$this.find(".sq_show_assistant").off("click").on("click",function(){$this.find("div.sq_assistant").find("ul").hide();$this.find("ul#sq_assistant_tasks_"+$(this).data("category")+"_"+$(this).data("id")).show(0,function(){$(this).fadeTo(0,.1).fadeTo("fast",1)})});$this.find(".sq_show_assistant").tooltip({placement:"left",trigger:"hover",html:true});$this.find(".sq_show_tooltip").tooltip({placement:"left",trigger:"hover",html:true})};$this.listenTableBullets();$this.find(".sq_show_snippet").tooltip({placement:"left",trigger:"hover",html:true});var args=Array.prototype.slice.call(arguments,0);return sq_Assistant.apply($this,args)};$(".sq_focuspages_refresh").on("click",function(){var $refresh=$(this);$refresh.addClass("fa-spin");$this.sq_getFocusPages();$this.on("sq_focuspages_loaded",function(){$this.listen();$refresh.removeClass("fa-spin")})});$this.listen=function(){$this.listenScrollbar();$("#sq_wrap").sq_Assistant();$(".sq_circle_label_input").on("change",function(){$this.sq_getFocusPages()});$(".sq_assistant_help ul").show()};$this.on("sq_focuspages_loaded",function(){$(".sq_save_ajax").find("input").on("change",function(){$(this).sq_ajaxCallListen()});$(".sq_save_ajax").find("button").on("click",function(){$(this).sq_ajaxCallListen()})});$this.listen()};$.fn.sq_innerLinks=function(){var $this=this;$this.bulkActionListener=function(){$this.find(".sq_bulk_select_input").on("click",function(){if(!$(this).is(":checked")){$this.find(".sq_bulk_input").prop("checked",false)}else{$this.find(".sq_bulk_input").prop("checked",true)}});$this.find(".sq_bulk_submit").on("click",function(){var $button=$(this);if($this.find(".sq_bulk_action").find(":selected").val()!==""){if($this.find(".sq_bulk_action").find(":selected").data("confirm")){if(!confirm($this.find(".sq_bulk_action").find(":selected").data("confirm"))){return}}var $sq_bulk_input=[];var $action=$this.find(".sq_bulk_action").find(":selected").val();jQuery($this.find(".sq_bulk_input").serializeArray()).each(function(){$sq_bulk_input.push($(this).attr("value"))});$button.addClass("sq_minloading");$.post(sqQuery.ajaxurl,{action:$action,inputs:$sq_bulk_input,sq_nonce:sqQuery.nonce}).done(function(response){if(typeof response.message!=="undefined"){$.sq_showMessage(response.message).addClass("sq_success");if($action.indexOf("delete")!==-1){$this.find(".sq_bulk_input").each(function(){if($(this).is(":checked")){$(this).parents("tr:last").remove();$(this).prop("checked",false)}})}else if($action.indexOf("check")!==-1){location.reload()}}else if(typeof response.error!=="undefined"){$.sq_showMessage(response.error)}$button.removeClass("sq_minloading")}).fail(function(){$button.removeClass("sq_minloading")},"json")}})};$this.addInnerListListener=function($table){$table.find(".sq_innerlink_add").on("click",function(e){e.preventDefault();var $button=$(this);var $form=$button.parents("form:last");if($.isFunction($.fn.sq_setFocusPageInnerlink)){$form.sq_setFocusPageInnerlink().done(function(response){if(typeof response.success!=="undefined"){if(response.success){$button.hide();$form.find(".sq_innerlink_done").show()}else{$button.hide();$form.find(".sq_innerlink_manual").show()}}})}})};$this.find(".sq_innerlinks_suggestion").sq_getFocusPageInnerlinks().done(function(response){if(typeof response!=="undefined"){if(typeof response.innerlinks!=="undefined"){$this.find(".sq_innerlinks_suggestion").show();$this.find(".sq_innerlinks_suggestion").off("click").on("click",function(){var $innelinks_modal=$("#sq_innerlinks_dialog");var $body=$innelinks_modal.find(".modal-body");$body.html("");$body.addClass("sq_loading");$(this).sq_getFocusPageInnerlinks().done(function(response){if(typeof response!=="undefined"){if(typeof response.html!=="undefined"){$body.html(response.html);$body.find(".table").DataTable({columnDefs:[{targets:[1,2,3],sortable:false},{targets:[0],sortable:true}],sDom:"Rfrtlip",bPaginate:true,bLengthChange:true,iDisplayLength:25,lengthMenu:[[10,25,50,100,-1],[10,25,50,100,"All"]],bFilter:true,fixedColumns:true}).on("order.dt",function(){$this.addInnerListListener($body.find(".table"))}).on("search.dt",function(){$this.addInnerListListener($body.find(".table"))}).on("draw.dt",function(){$this.addInnerListListener($body.find(".table"))});$this.addInnerListListener($body.find(".table"))}}$body.removeClass("sq_loading")});$innelinks_modal.modal("show")})}}});$this.bulkActionListener()};$.fn.sq_getFocusPages=function(){var $this=this;var $sid=$.sq_getParam("sid");var $sq_slabels=[];$this.find(".sq_circle_label_input:checked").each(function(){$sq_slabels.push($(this).val())});$this.addClass("sq_minloading");return $.post(sqQuery.ajaxurl,{action:"sq_focuspages_getpage",sid:$sid?$sid:null,slabel:$sq_slabels,sq_nonce:sqQuery.nonce}).done(function(response){if(typeof response!=="undefined"){if(typeof response.html!=="undefined"){$("#sq_wrap div.tooltip").hide();$this.find(".sq_focuspages_content").html(response.html);$this.trigger("sq_focuspages_loaded");$this.listen()}else{$("#sq_focuspages").trigger("error.refresh",response)}if(typeof response.error!=="undefined"){$.sq_showMessage(response.error,5e3).addClass("sq_error")}}else{$("#sq_focuspages").trigger("error.refresh",response)}$this.removeClass("sq_minloading")}).fail(function(error){$("#sq_focuspages").trigger("error.refresh",error);$this.removeClass("sq_minloading")},"json")};$.fn.sq_getFocusPageInnerlinks=function(){var $this=this;var $post_id=$this.data("post_id");var $post_type=$this.data("post_type");$this.addClass("sq_minloading");return $.post(sqQuery.ajaxurl,{action:"sq_focuspages_getinnerlinks",post_id:$post_id,post_type:$post_type,sq_nonce:sqQuery.nonce}).done(function(response){$this.removeClass("sq_minloading")}).fail(function(error){$this.removeClass("sq_minloading")},"json")};$.fn.sq_setFocusPageInnerlink=function(){var $form=this;$form.addClass("sq_minloading");return $.post(sqQuery.ajaxurl,$form.serialize()).done(function(response){if(typeof response!=="undefined"){if(typeof response.error!=="undefined"){$.sq_showMessage(response.error,5e3).addClass("sq_error")}}else{$("#sq_focuspages").trigger("error.refresh",error)}$form.removeClass("sq_minloading")}).fail(function(error){$("#sq_focuspages").trigger("error.refresh",error);$form.removeClass("sq_minloading")},"json")};$.fn.sq_inspectURL=function(){var $this=this;$this.find(".modal-body").addClass("sq_loading");$this.find(".modal-body").html("");var post_id=$this.attr("data-post_id");$this.modal("show");$.post(sqQuery.ajaxurl,{action:"sq_focuspages_inspecturl",post_id:post_id,sq_nonce:sqQuery.nonce}).done(function(response){if(typeof response!=="undefined"){if(typeof response.html!=="undefined"&&response.html){$this.find(".modal-body").html(response.html)}else{$this.find(".modal-body").html("Page could not load")}if(typeof response.error!=="undefined"){$.sq_showMessage(response.error,5e3).addClass("sq_error")}}$this.find(".modal-body").removeClass("sq_loading")}).fail(function(error){$this.trigger("error.refresh",error);$this.find(".modal-body").removeClass("sq_loading")},"json")};$.fn.sq_changeMainKeyword=function(){var $button=$(this);var $this=$button.parents(".modal:last");$button.addClass("sq_minloading");var post_id=$this.attr("data-post_id");var keyword=$this.find("select option:selected").val();$.post(sqQuery.ajaxurl,{action:"sq_briefcase_savemain",post_id:post_id,keyword:keyword,sq_nonce:sqQuery.nonce}).done(function(response){if(typeof response!=="undefined"){if(typeof response.saved!=="undefined"){$.sq_showMessage(response.saved,2e3)}if(typeof response.error!=="undefined"){$.sq_showMessage(response.error,5e3).addClass("sq_error")}}$button.removeClass("sq_minloading")}).fail(function(error){$this.trigger("error.refresh",error);$button.removeClass("sq_minloading")},"json")};$(document).ready(function(){$("#sq_focuspages").sq_focusPages();$("#sq_innerlinks").sq_innerLinks();$(".sq_main_keyword_dialog").find("button.btn-save").on("click",function(){$(this).sq_changeMainKeyword()});$("#sq_focuspages").on("error.refresh",function(){$.sq_showMessage("Couldn't load the data. <span class='sq_refresh' style='color:#F9A825; cursor:pointer;'>Please refresh</span>.",1e4).addClass("sq_error");$(".sq_refresh").on("click",function(){location.reload()})})})})(jQuery);