import{r as x,a as n,j as e,_ as l,F as U}from"./main.6.5.4.js";import{r as v}from"./react-vendor-0bea0611.js";import{u as C,a as T}from"./@tanstack/react-query-78c0f9b7.js";import{T as z,h as a,S as f,l as r,B as P,o as E,c as h,m as p,p as b,n as S}from"./antd-dafe50ab.js";import"./@emotion/react-323787dc.js";import"./react-router-dom-5de063b6.js";import"./@tanstack/react-query-devtools-c62a49db.js";function M(){const{data:i,isLoading:u,isFetching:o}=C({refetchOnWindowFocus:!1,staleTime:12e4,queryKey:["fetch_permissions_settings"],queryFn:async()=>x({action:"permissions/get",method:"GET"})});return{isLoading:u,isFetching:o,permissions:i==null?void 0:i.data.permissions,roles:i==null?void 0:i.data.roles,users:i==null?void 0:i.data.users,commands:i==null?void 0:i.data.commands,fileTypes:i==null?void 0:i.data.fileTypes,wpRoot:i==null?void 0:i.data.wpRoot}}function j(){const{mutateAsync:i,isLoading:u}=T(async o=>x({action:"permissions/update",data:o}));return{updatePermission:o=>i(o),isPermissionUpdating:u}}function k(){const{useForm:i}=r,{isLoading:u,permissions:o,commands:d,fileTypes:g,roles:F,users:I}=M(),{updatePermission:w,isPermissionUpdating:_}=j(),[m]=i();v.useEffect(()=>{m.setFieldsValue(o)},[o,m]);const R=t=>{w(t).then(s=>{if(s.code==="SUCCESS"){S.success({message:s.message});const y=m.getFieldsError().map(c=>(c.errors&&(c.errors=[]),c));m.setFields(y)}else{const y=[];Object.keys(s.data).forEach(c=>{y.push({name:c.split("."),errors:s.data[c]}),S.error({message:(s==null?void 0:s.message)??l("Failed to update permission")})}),m.setFields(y)}})};return n(U,{children:[e(a,{title:"File Manager Shortcode",style:{marginInline:"0.625rem"},children:e(z.Text,{copyable:{text:"[file-manager]"},children:"[file-manager]"})}),e(r,{form:m,onFinish:R,disabled:u||_,initialValues:o,colon:!1,scrollToFirstError:!0,children:n(f,{direction:"vertical",size:"middle",style:{display:"flex"},className:"px-2",children:[e(f,{style:{display:"flex",justifyContent:"right",paddingBlock:"8px"},children:e(r.Item,{style:{marginBottom:0},children:e(P,{type:"primary",htmlType:"submit",loading:_,children:"Update"})})}),n(a,{children:[e(r.Item,{name:"do_not_use_for_admin",label:l("Disable this permission inside WordPress dashboard"),tooltip:l("If disabled, the root folder for the file manager will be determined by this permission setting."),children:e(E,{})}),e(r.Item,{name:"fileType",label:"Allowed MIME types",children:e(h,{mode:"multiple",children:g==null?void 0:g.map(t=>e(h.Option,{value:t,children:t},t))})}),e(r.Item,{name:"file_size",label:"Max upload Size",children:e(p,{type:"number",placeholder:"Maximum File Size",addonAfter:"MB"})})]}),n(a,{title:l("Public folder options"),children:[e(r.Item,{name:"root_folder",children:e(p,{placeholder:"Root Folder Path"})}),e(r.Item,{name:"root_folder_url",children:e(p,{placeholder:"Root Folder URL"})}),e(r.Item,{name:"folder_options",label:l("Folder Options"),children:n(b.Group,{size:"large",children:[e(b,{value:"common",children:"Enable a common folder for everyone"}),e(b,{value:"user",children:"Enable separate folders for each user"}),e(b,{value:"role",children:"Enable folders for each user role"})]})})]}),e(a,{title:l("Permissions by Roles"),children:e(f,{size:20,wrap:!0,children:F==null?void 0:F.map(t=>n(a,{title:t.toUpperCase(),children:[e(r.Item,{name:["by_role",t,"path"],label:l("Path"),children:e(p,{placeholder:"Root Folder Path"})}),e(r.Item,{name:["by_role",t,"commands"],label:l("Enabled Commands"),children:e(h,{mode:"multiple",children:d==null?void 0:d.map(s=>e(h.Option,{value:s,children:s},s))})})]},`permissions-for-${t}`))})}),e(a,{title:l("Permissions by User"),children:e(f,{size:20,wrap:!0,children:I==null?void 0:I.map(t=>n(a,{title:t.display_name,children:[e(r.Item,{name:["by_user",t.ID,"path"],label:l("Path"),children:e(p,{placeholder:"Root Folder Path"})}),e(r.Item,{name:["by_user",t.ID,"commands"],label:l("Enabled Commands"),children:e(h,{mode:"multiple",children:d==null?void 0:d.map(s=>e(h.Option,{value:s,children:s},s))})})]},`permissions-for-${t.ID}`))})}),n(a,{title:l("Guest User Settings"),children:[e(r.Item,{name:["guest","path"],label:l("Path"),children:e(p,{placeholder:"Root Folder Path"})}),e(r.Item,{name:["guest","can_download"],label:l("can download?"),children:e(E,{})})]}),e(r.Item,{children:e(f,{style:{display:"flex",justifyContent:"center"},children:e(r.Item,{children:e(P,{type:"primary",htmlType:"submit",loading:_,children:"Update"})})})})]})})]})}export{k as default};
