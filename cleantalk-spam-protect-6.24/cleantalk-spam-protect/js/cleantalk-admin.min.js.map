{"version":3,"file":"cleantalk-admin.min.js","sources":["cleantalk-admin.js"],"sourcesContent":["jQuery(document).ready(function($) {\n    // Auto update banner close handler\n    jQuery('.apbct_update_notice').on('click', 'button', function() {\n        let ctDate = new Date(new Date().getTime() + 1000 * 86400 * 30 );\n        let ctSecure = location.protocol === 'https:' ? '; secure' : '';\n        document.cookie = 'apbct_update_banner_closed=1; path=/; expires=' +\n        ctDate.toUTCString() + '; samesite=lax' + ctSecure;\n    });\n\n    jQuery('li a[href=\"options-general.php?page=cleantalk\"]').css('white-space', 'nowrap')\n        .css('display', 'inline-block');\n\n    jQuery('body').on('click', '.apbct-notice .notice-dismiss', function(e) {\n        let apbctNoticeName = jQuery(e.target).parent().attr('id');\n        if ( apbctNoticeName ) {\n            apbct_admin_sendAJAX(\n                {\n                    'action': 'cleantalk_dismiss_notice',\n                    'notice_id': apbctNoticeName,\n                },\n                {\n                    'callback': null,\n                    'notJson': true,\n                },\n            );\n        }\n    });\n\n    jQuery('body').on('click', '.apbct-notice .notice-dismiss-link', function(e) {\n        let apbctNoticeName = jQuery(e.target).parent().attr('id');\n        if ( apbctNoticeName ) {\n            apbct_admin_sendAJAX(\n                {\n                    'action': 'cleantalk_dismiss_notice',\n                    'notice_id': apbctNoticeName,\n                },\n                {\n                    'callback': null,\n                    'notJson': true,\n                },\n            );\n            jQuery(e.target).parent().closest('.apbct-notice').fadeOut(500);\n        }\n    });\n\n    // Notice when deleting user\n    jQuery('.ct_username .row-actions .delete a').on('click', function(e) {\n        e.preventDefault();\n\n        let result = confirm(ctAdminCommon.notice_when_deleting_user_text);\n\n        if (result) {\n            window.location = this.href;\n        }\n    });\n\n    // Restore spam order\n    $('.apbct-restore-spam-order-button').click(function() {\n        const spmOrderId = $(this).data('spam-order-id');\n        let data = {\n            action: 'apbct_restore_spam_order',\n            _ajax_nonce: ctAdminCommon._ajax_nonce,\n            order_id: spmOrderId,\n        };\n        $.ajax({\n            type: 'POST',\n            url: ctAdminCommon._ajax_url,\n            data: data,\n            success: function(result) {\n                if (result.success) {\n                    window.location.reload();\n                } else {\n                    alert(result.data.message);\n                }\n            },\n        });\n    });\n\n    // Deactivation banner\n    jQuery('#deactivate-cleantalk-spam-protect').on('click', function(e) {\n        e.preventDefault();\n        const deactivationLink = this.getAttribute('href');\n\n        if ( typeof cleantalkModal !== 'undefined' && ctAdminCommon.deactivation_banner_is_needed === '1') {\n            const modalHTML = `\n                <div class=\"ct-modal-message\">\n                    ${ctAdminCommon.deactivation_banner_text}\n                </div>\n                <div class=\"ct-modal-buttons\">\n                    <button class=\"button action\" onclick=\"cleantalkModal.close();\">Ok</button>\n                    <a class=\"button action\" href=\"${deactivationLink}\">No, deactivate anyway</a>\n                </div>\n            `;\n            cleantalkModal.loaded = modalHTML;\n            cleantalkModal.open();\n        } else {\n            window.location.href = deactivationLink;\n        }\n    });\n});\n\n// eslint-disable-next-line camelcase,require-jsdoc,no-unused-vars\nfunction apbct_admin_sendAJAX(data, params, obj) {\n    // Default params\n    let callback = params.callback || null;\n    let callbackContext = params.callback_context || null;\n    let callbackParams = params.callback_params || null;\n    let async = params.async || true;\n    let notJson = params.notJson || null;\n    let timeout = params.timeout || 15000;\n    var obj = obj || null; // eslint-disable-line no-var\n    let button = params.button || null;\n    let spinner = params.spinner || null;\n    let progressbar = params.progressbar || null;\n\n    if (typeof (data) === 'string') {\n        data = data + '&_ajax_nonce=' + ctAdminCommon._ajax_nonce + '&no_cache=' + Math.random();\n    } else {\n        data._ajax_nonce = ctAdminCommon._ajax_nonce;\n        data.no_cache = Math.random();\n    }\n    // Button and spinner\n    if (button) {\n        button.setAttribute('disabled', 'disabled'); button.style.cursor = 'not-allowed';\n    }\n    if (spinner) jQuery(spinner).css('display', 'inline');\n\n    jQuery.ajax({\n        type: 'POST',\n        url: ctAdminCommon._ajax_url,\n        data: data,\n        async: async,\n        success: function(result) {\n            if (button) {\n                button.removeAttribute('disabled'); button.style.cursor = 'pointer';\n            }\n            if (spinner) jQuery(spinner).css('display', 'none');\n            if (!notJson) result = JSON.parse(result);\n            if (result.error) {\n                setTimeout(function() {\n                    if (progressbar) progressbar.fadeOut('slow');\n                }, 1000);\n                if ( typeof cleantalkModal !== 'undefined' ) {\n                    // Show the result by modal\n                    cleantalkModal.loaded = 'Error:<br>' + result.error.toString();\n                    cleantalkModal.open();\n                } else {\n                    alert('Error happens: ' + (result.error || 'Unkown'));\n                }\n            } else {\n                if (callback) {\n                    if (callbackParams) {\n                        callback.apply( callbackContext, callbackParams.concat( result, data, params, obj ) );\n                    } else {\n                        callback(result, data, params, obj);\n                    }\n                }\n            }\n        },\n        error: function(jqXHR, textStatus, errorThrown) {\n            if (button) {\n                button.removeAttribute('disabled'); button.style.cursor = 'pointer';\n            }\n            if (spinner) jQuery(spinner).css('display', 'none');\n            console.log('APBCT_AJAX_ERROR');\n            console.log(jqXHR);\n            console.log(textStatus);\n            console.log(errorThrown);\n        },\n        timeout: timeout,\n    });\n}\n"],"names":["apbct_admin_sendAJAX","data","params","obj","let","callback","callbackContext","callback_context","callbackParams","callback_params","async","notJson","timeout","button","spinner","progressbar","ctAdminCommon","_ajax_nonce","Math","random","no_cache","setAttribute","style","cursor","jQuery","css","ajax","type","url","_ajax_url","success","result","removeAttribute","JSON","parse","error","setTimeout","fadeOut","cleantalkModal","loaded","toString","open","alert","apply","concat","jqXHR","textStatus","errorThrown","console","log","document","ready","$","on","ctDate","Date","getTime","ctSecure","location","protocol","cookie","toUTCString","e","apbctNoticeName","target","parent","attr","action","notice_id","closest","preventDefault","confirm","notice_when_deleting_user_text","window","this","href","click","spmOrderId","order_id","reload","message","modalHTML","deactivationLink","getAttribute","deactivation_banner_is_needed","deactivation_banner_text"],"mappings":"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"}