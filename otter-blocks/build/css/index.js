!function(){"use strict";var e=window.lodash,t=window.wp.i18n,s=window.wp.blocks,o=window.wp.blockEditor,n=window.wp.components,c=window.wp.compose,r=window.wp.data,i=window.wp.element,l=window.wp.hooks,a=window.ReactJSXRuntime;let d=null;window.otterCSSLintIgnored=[];var u=(0,i.memo)((({attributes:e,setAttributes:s,clientId:o})=>{const c=(0,i.useRef)(null),[l,u]=(0,i.useState)([]),[m,p]=(0,i.useState)(null),w=(e,t=!1)=>{let s=e?.state?.lint?.marked?.filter((({__annotation:e})=>"error"===e?.severity))?.map((({__annotation:e})=>e?.message));t&&0<s?.length&&(window.otterCSSLintIgnored=s),s=s?.filter((e=>!window.otterCSSLintIgnored.includes(e))),u(s),!t&&0<s?.length||p(e?.getValue())};return(0,i.useEffect)((()=>{const t=e.customCSS&&e.className?.includes("ticss-")?e.className.split(" ").find((e=>e.includes("ticss"))):null;let s="selector {\n}\n";if(e.customCSS){const o=new RegExp("."+t,"g");s=e.customCSS.replace(o,"selector")}c.current=wp.CodeMirror(document.getElementById("o-css-editor"),{value:s,autoCloseBrackets:!0,continueComments:!0,lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,lint:!0,gutters:["CodeMirror-lint-markers"],styleActiveLine:!0,styleActiveSelected:!0,mode:"css",extraKeys:{"Ctrl-Space":"autocomplete","Alt-F":"findPersistent","Cmd-F":"findPersistent"}});const o=()=>{window?.oTrk?.add({feature:"custom-css",featureComponent:"used"}),clearTimeout(d),d=setTimeout((()=>{w(c.current)}),500)};return c.current.on("change",o),()=>{c.current.off("change",o)}}),[]),(0,i.useEffect)((()=>{const t=new RegExp("selector","g"),n=(()=>{const t=o.substring(0,8);if(m?.replace(/\s+/g,"")==="selector {\n}\n".replace(/\s+/g,""))return e.className?e.className.split(" ").filter((e=>!e.includes("ticss-"))).join(" "):e.className;const{className:s}=e;return s?s.includes("ticss-")?s:[...s.trim().split(" "),`ticss-${t}`].join(" "):`ticss-${t}`})(),c=n?.split(" ").find((e=>e.includes("ticss"))),r=c?m?.replace(t,`.${c}`):m;"selector {\n}\n".replace(/\s+/g,"")===r?.replace(/\s+/g,"")?s({customCSS:void 0,className:n}):r&&s({customCSS:r,hasCustomCSS:!0,className:n})}),[m]),(0,a.jsxs)(i.Fragment,{children:[!Boolean(window?.blocksCSS?.hasOtter)&&!!(0,r.select)("core/edit-site")&&(0,a.jsxs)(n.Notice,{status:"info",isDismissible:!1,children:[(0,t.__)("Blocks CSS is not fully compatible with the Site Editor. We recommend installing Otter for Site Builder compatibility.","blocks-css"),(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),(0,a.jsx)(n.Button,{variant:"primary",href:window?.blocksCSS?.installOtter,target:"_blank",children:(0,t.__)("Install Otter","blocks-css")})]}),(0,a.jsx)("p",{children:(0,t.__)("Add your custom CSS.","blocks-css")}),(0,a.jsx)("div",{id:"o-css-editor",className:"o-css-editor"}),0<l?.length&&(0,a.jsxs)("div",{className:"o-css-errors",children:[(0,a.jsx)(n.Notice,{status:"error",isDismissible:!1,children:(0,t.__)("Attention needed! We found following errors with your code:","blocks-css")}),(0,a.jsx)("pre",{children:(0,a.jsx)("ul",{children:l.map(((e,t)=>(0,a.jsx)("li",{children:e},t)))})}),(0,a.jsx)(n.Button,{variant:"secondary",onClick:()=>w(c.current,!0),style:{width:"max-content",marginBottom:"20px"},children:(0,t.__)("Override","blocks-css")})]}),(0,a.jsxs)("p",{children:[(0,t.__)("Use","blocks-css")," ",(0,a.jsx)("code",{children:"selector"})," ",(0,t.__)("to target block wrapper.","blocks-css")]}),(0,a.jsx)("br",{}),(0,a.jsx)("p",{children:(0,t.__)("Example:","blocks-css")}),(0,a.jsx)("pre",{className:"o-css-editor-help",children:"selector {\n    background: #000;\n}\n\nselector img {\n    border-radius: 100%;\n}"}),(0,a.jsx)("p",{children:(0,t.__)("You can also use other CSS syntax here, such as media queries.","blocks-css")})]})}));let m=!0;const p=e=>{const t=window.parent.document.querySelector('iframe[name="editor-canvas"]')?.contentWindow;let s=t?.document.head||document.head,o=s.querySelector("#o-css-editor-styles");return m&&t?(t.addEventListener("DOMContentLoaded",(function(){setTimeout((()=>{p(e)}),500)})),void(m=!1)):(null===o&&(o=document.createElement("style"),o.setAttribute("type","text/css"),o.setAttribute("id","o-css-editor-styles"),s?.appendChild(o)),o.textContent===e?null:o.textContent=e)},w=(t,o)=>{if(!t)return"";const n=e=>{const t=[];if("core/block"===e.name&&null!==o){const c=o.find((t=>e.attributes.ref===t.id));if(c&&c.content){const e=c.content.hasOwnProperty("raw")?c.content.raw:c.content;t.push((0,s.parse)(e).map((e=>[e,n(e)])))}}return void 0!==e.innerBlocks&&0<e.innerBlocks.length&&t.push(e.innerBlocks.map((e=>[e,n(e)]))),t},c=t.map((e=>[e,n(e)]));return(0,e.flattenDeep)(c).map((e=>e.attributes&&e.attributes.hasCustomCSS&&e.attributes.customCSS&&null!==e.attributes.customCSS?e.attributes.customCSS+"\n":"")).reduce(((e,t)=>e+t),"")};let h=[],S=!1;const b=(0,e.debounce)((()=>{const{getBlocks:t,isTyping:s}=(0,r.select)("core/block-editor"),o=!!(0,r.select)("core/edit-post")&&(0,r.select)("core/edit-post").__experimentalGetPreviewDeviceType(),n=t(),c=(0,r.select)("core").getEntityRecords("postType","wp_block",{context:"view"});if(!(s()||(0,e.isEqual)(h,n)&&S===o)){const e=w(n,c);e&&(S!==o&&"Desktop"===S?setTimeout((()=>{p(e)}),500):p(e)),h=n,S=o}}),300);(0,r.subscribe)(b);const C=({clientId:e,setAttributes:s,attributes:o})=>(0,a.jsxs)(n.PanelBody,{title:(0,t.__)("Custom CSS","blocks-css"),initialOpen:!1,children:[(0,a.jsx)(u,{clientId:e,setAttributes:s,attributes:o}),(0,a.jsxs)("div",{className:"o-fp-wrap",children:[(0,l.applyFilters)("otter.feedback","","custom-css"),(0,l.applyFilters)("otter.poweredBy","")]})]}),k=(0,c.createHigherOrderComponent)((e=>t=>(0,s.hasBlockSupport)(t.name,"customClassName",!0)&&t.isSelected?(0,a.jsxs)(i.Fragment,{children:[(0,a.jsx)(e,{...t}),(0,a.jsx)(o.InspectorControls,{children:(0,a.jsx)(C,{...t})})]}):(0,a.jsx)(e,{...t})),"withInspectorControl");(0,l.addFilter)("blocks.registerBlockType","themeisle-custom-css/attribute",(t=>((0,s.hasBlockSupport)(t,"customClassName",!0)&&(t.attributes=(0,e.assign)(t.attributes,{hasCustomCSS:{type:"boolean",default:!1},customCSS:{type:"string"}})),t))),Boolean(window?.blocksCSS?.hasOtter)?(0,l.addFilter)("otter.blockTools","themeisle-custom-css/with-inspector-controls",((e,o)=>{if((0,s.hasBlockSupport)(o.name,"customClassName",!0)){var c;const s=Boolean(null===(c=(0,r.select)("core/preferences")?.get("themeisle/otter-blocks","show-custom-css"))||void 0===c||c);return(0,a.jsxs)(i.Fragment,{children:[e,(0,a.jsx)(n.__experimentalToolsPanelItem,{hasValue:()=>Boolean(o.attributes?.hasCustomCSS),label:(0,t.__)("Custom CSS","blocks-css"),onDeselect:()=>{o.setAttributes({hasCustomCSS:!1,customCSS:void 0}),(()=>{const{getBlocks:e}=(0,r.select)("core/block-editor"),t=e(),s=(0,r.select)("core").getEntityRecords("postType","wp_block",{context:"view"}),o=w(t,s);p(o)})()},isShownByDefault:s,children:(0,a.jsx)(C,{...o})})]})}return e}),2):(0,l.addFilter)("editor.BlockEdit","themeisle-custom-css/with-inspector-controls",k)}();