jQuery(document).ready(($)=>{const avNonce=av_settings.nonce;let avFiles=[];let avFilesLoaded;function checkThemeFile(current){const id=parseInt(current||0);const file=avFiles[id];$.post(ajaxurl,{action:'get_ajax_response',_ajax_nonce:avNonce,_theme_file:file,_action_request:'check_theme_file',},(input)=>{if(input){if(!input.nonce||input.nonce!==avNonce){return}
const row=$('#av-scan-result-'+id);row.addClass('av-status-warning').removeClass('av-status-pending');row.find('td.av-status-column').text(av_settings.texts.warning);const lines=input.data;for(let i=0;i<lines.length;i=i+3){const md5=lines[i+2];const line=lines[i+1].replace(/@span@/g,'<span>').replace(/@\/span@/g,'</span>');row.find('td.av-file-column').append('<p><code>'+line+'</code> <a href="#" id="av-dismiss-'+md5+'" class="button" title="'+av_settings.texts.dismiss+'">'+av_settings.labels.dismiss+'</a></p>');$('#av-dismiss-'+md5).click((evt)=>{$.post(ajaxurl,{action:'get_ajax_response',_ajax_nonce:avNonce,_file_md5:evt.target.id.substring(11),_action_request:'update_white_list',},(res)=>{if(!res){return}
if(!res.nonce||res.nonce!==avNonce){return}
const issue=$('#av-dismiss-'+res.data[0]).parent();const col=issue.parent();issue.hide('slow').remove();if(col.find('p').length===0){col.parent().addClass('av-status-ok').removeClass('av-status-warning');col.parent().find('td.av-status-column').text(av_settings.texts.ok)}});return!1})}}else{const row=$('#av-scan-result-'+id);row.addClass('av-status-ok').removeClass('av-status-pending');row.find('td.av-status-column').text(av_settings.texts.ok)}
avFilesLoaded++;if(avFilesLoaded>=avFiles.length){$('#av-scan-process').html('<span class="av-scan-complete">'+av_settings.labels.complete+'</span>').fadeOut().fadeIn().fadeOut().fadeIn().fadeOut().fadeIn().animate({opacity:1.0},500)}else{checkThemeFile(id+1)}})}
$('#av-scan-trigger').click(()=>{$.post(ajaxurl,{action:'get_ajax_response',_ajax_nonce:avNonce,_action_request:'get_theme_files',},(input)=>{let output='<table class="wp-list-table widefat fixed striped table-view-list av-scan-results">'+'<thead><tr class="av-status-pending">'+'<td class="av-toggle-column check-column"></td>'+'<th class="av-file-column">Theme File</th>'+'<th class="av-status-column">Check Status</th>'+'</tr></thead>'+'<tbody>';if(!input){return}
if(!input.nonce||input.nonce!==avNonce){return}
avFiles=input.data;avFilesLoaded=0;$.each(avFiles,(i,val)=>{output+='<tr id="av-scan-result-'+i+'">'+'<td class="av-toggle-column check-column"></td>'+'<td class="av-file-column">'+val+'</td>'+'<td class="av-status-column">'+av_settings.texts.pending+'</td>'+'</tr>'});output+='</tbody><tfoot><tr>'+'<td class="av-toggle-column check-column"></td>'+'<th class="av-file-column">'+av_settings.labels.file+'</th><th class="av-status-column">'+av_settings.labels.status+'</th></tr></tfoot></table>';$('#av-scan-process').html('<span class="spinner is-active" title="running"></span>');$('#av-scan-output').empty().append(output);checkThemeFile()});return!1});function manageOptions(){const cbSelectors=['#av_cronjob_enable','#av_safe_browsing','#av_checksum_verifier',];let anyEnabled=!1;cbSelectors.forEach((c)=>{const cb=$(c);const inputs=cb.parents('fieldset').find(':text, :checkbox').not(cb);let enabled;if(typeof $.fn.prop==='function'){enabled=!!cb.prop('checked');inputs.prop('disabled',!enabled)}else{enabled=!!cb.attr('checked');inputs.attr('disabled',!enabled)}
anyEnabled=anyEnabled||enabled});if(typeof $.fn.prop==='function'){$('#av_notify_email').prop('disabled',!anyEnabled)}else{$('#av_notify_email').attr('disabled',!anyEnabled)}}
$('#av_settings input[type=checkbox]').click(manageOptions);manageOptions()})