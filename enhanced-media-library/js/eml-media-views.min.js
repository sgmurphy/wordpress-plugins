window.wp=window.wp||{},window.eml=window.eml||{l10n:{}},function(e,t){var i=wp.media,r=i.view.l10n,l=i.view.settings.mediaTrash,o={},s={};t.extend(eml.l10n,wpuxss_eml_mvln),t.defaults(eml.l10n,{media_orderby:"date",media_order:"DESC"}),o.controllerLibrary={activate:i.controller.Library.prototype.activate},t.extend(i.controller.Library.prototype,{activate:function(){o.controllerLibrary.activate.apply(this,arguments),wp.Uploader.queue.on("add",this.beforeUpload,this),wp.Uploader.queue.on("reset",this.afterUpload,this)},beforeUpload:function(){1==wp.Uploader.queue.length&&e('.attachment-filters:has(option[value!="all"]:selected)').val("all").change()},afterUpload:function(){var e=this.get("library"),t=this.get("selection");"menuOrder"===e.props.get("orderby")&&e.saveMenuOrder(),e.reset(e.models),t.trigger("selection:unsingle",t.model,t),t.trigger("selection:single",t.model,t)},uploading:function(e){var t=this.frame.content,i=this.get("selection");"upload"===t.mode()&&this.frame.content.mode("browse"),this.get("autoSelect")&&(1==wp.Uploader.queue.length&&i.length&&i.reset(),i.add(e),i.trigger("selection:unsingle",i.model,i),i.trigger("selection:single",i.model,i))}}),t.extend(i.controller.Library.prototype.defaults,{idealColumnWidth:eml.l10n.ideal_column_width||170}),t.extend(i.view.Attachments.prototype.defaults,{idealColumnWidth:e(window).width()<640?135:eml.l10n.ideal_column_width||150}),s={"click input[type=checkbox]":"preSave"},t.extend(s,i.view.AttachmentCompat.prototype.events),o.AttachmentCompat={postSave:i.view.AttachmentCompat.prototype.postSave},t.extend(i.view.AttachmentCompat.prototype,{events:s,preSave:function(){var t,r=e("input[type=checkbox]",this.$el);this.controller.isModeActive("eml-grid")&&(t=this.controller.browserView.toolbar.get("spinner")),r.prop("readonly",!0),t&&t.show(),this.noRender=!0,this.rendered=!1,i.model.Query.cleanQueries()},postSave:function(t){var i,r,l,s,n=e("input[type=checkbox]",this.$el);o.AttachmentCompat.postSave.apply(this,arguments),this.controller.isModeActive("eml-grid")&&(l=this.controller.browserView.toolbar.get("spinner")),n.prop("readonly",!1),l&&l.hide(),"edit-attachment"!==this.controller._state&&(s=this.controller.toolbar.get()),s&&(r=t?"emlAttachmentSuccess":"emlAttachmentError",(i=s.get(r)).$el.fadeIn(200),setTimeout(function(){i.$el.fadeOut(100)},800))},render:function(){var i=this.model.get("compat"),r=this.$el,l=this.model.get("tcount");if(i&&i.item)return t.each(l,function(t,i){var r=e('.eml-taxonomy-filters option[value="'+i+'"]'),l=r.text();l=l.replace(/\(.*?\)/,"("+t+")"),r.text(l)}),this.noRender?this:(this.views.detach(),this.$el.html(i.item),this.views.render(),this.controller.isModeActive("select")&&"edit-attachment"!==this.controller._state&&(e.each(eml.l10n.compat_taxonomies_to_hide,function(e,t){r.find(".compat-field-"+t).remove()}),this.$el.find(".compat-attachment-fields tbody").children().length||this.$el.find(".media-types-required-info").hide()),e.each(eml.l10n.compat_taxonomies,function(e,t){r.find(".compat-field-"+t+" .label").addClass("eml-tax-label"),r.find(".compat-field-"+t+" .field").addClass("eml-tax-field")}),this)}}),t.extend(i.view.AttachmentFilters.prototype,{change:function(){var i=this.filters[this.el.value],r=this.controller.state().get("selection"),o=this.controller.content.get().toolbar.get("resetFilterButton"),s=e(".attachment-filters").length,n=e(".attachment-filters").map(function(){return this.value}).get().filter(function(e){return"all"===e}).length;i&&this.model.set(i.props),i&&r&&r.length&&1!==wp.Uploader.queue.length&&r.reset(),i&&l&&!t.isUndefined(this.controller.toolbar)&&this.controller.toolbar.get().$(".media-selection").toggleClass("trash","trash"===i.props.status),t.isUndefined(o)||o.model.set("disabled",s===n)},select:function(){var e=this.model,i="all",r=e.toJSON();r=t.omit(r,"orderby","order"),t.find(this.filters,function(e,l){var o=t.omit(e.props,"orderby","order");if(t.all(o,function(e,i){return e===(t.isUndefined(r[i])?null:r[i])}))return i=l}),this.$el.val(i)}}),o.AttachmentFilters={All:{createFilters:i.view.AttachmentFilters.All.prototype.createFilters},Uploaded:{createFilters:i.view.AttachmentFilters.Uploaded.prototype.createFilters}},t.extend(i.view.AttachmentFilters.All.prototype,{createFilters:function(){var e,i=t.intersection(t.keys(eml.l10n.taxonomies),eml.l10n.filter_taxonomies);o.AttachmentFilters.All.createFilters.apply(this,arguments),t.each(this.filters,function(e,t){e.props.uncategorized=null,e.props.orderby=eml.l10n.media_orderby,e.props.order=eml.l10n.media_order}),this.filters.uncategorized={text:eml.l10n.uncategorized,props:{uploadedTo:null,uncategorized:!0,status:null,type:null,orderby:eml.l10n.media_orderby,order:eml.l10n.media_order},priority:60},e=this.filters.uncategorized.props,t.each(i,function(t){e[t]=null}),l&&(this.controller.isModeActive("grid")||this.controller.isModeActive("eml-grid"))&&(this.filters.trash={text:r.trash,props:{uploadedTo:null,status:"trash",type:null,orderby:"date",order:"DESC"},priority:70})}}),t.extend(i.view.AttachmentFilters.Uploaded.prototype,{createFilters:function(){o.AttachmentFilters.Uploaded.createFilters.apply(this,arguments),t.each(this.filters,function(e,t){e.props.orderby=eml.l10n.media_orderby,e.props.order=eml.l10n.media_order})}}),i.view.AttachmentFilters.Taxonomy=i.view.AttachmentFilters.extend({id:function(){return"media-attachment-"+this.options.taxonomy+"-filters"},className:function(){return"attachment-filters eml-taxonomy-filters attachment-"+this.options.taxonomy+"-filter"},createFilters:function(){var i={},r=this;t.each(r.options.termList||{},function(t,l){var o=t.term_id,s=e("<div/>").html(t.term_row).text();i[o]={text:s,props:{uncategorized:null,orderby:eml.l10n.media_orderby,order:eml.l10n.media_order},priority:l+4},i[o].props[r.options.taxonomy]=o}),i.all={text:eml.l10n.filter_by+" "+r.options.pluralName,props:{uncategorized:null,orderby:eml.l10n.media_orderby,order:eml.l10n.media_order},priority:1},i.all.props[r.options.taxonomy]=null,i.in={text:"&#8212; "+eml.l10n.in+" "+r.options.pluralName+" &#8212;",props:{uncategorized:null,orderby:eml.l10n.media_orderby,order:eml.l10n.media_order},priority:2},i.in.props[r.options.taxonomy]="in",i.not_in={text:"&#8212; "+eml.l10n.not_in+" "+r.options.pluralName+" &#8212;",props:{uncategorized:null,orderby:eml.l10n.media_orderby,order:eml.l10n.media_order},priority:3},i.not_in.props[r.options.taxonomy]="not_in",this.filters=i}}),i.view.AttachmentFilters.Authors=i.view.AttachmentFilters.extend({createFilters:function(){var e={};t.each(this.options.users||{},function(t,i){var r=t.user_id,l=t.user_name;e[r]={text:l,props:{author:r,orderby:eml.l10n.media_orderby,order:eml.l10n.media_order},priority:i+2}}),e.all={text:eml.l10n.in+" "+eml.l10n.authors,props:{author:null,orderby:eml.l10n.media_orderby,order:eml.l10n.media_order},priority:1},this.filters=e}}),i.view.Button.resetFilters=i.view.Button.extend({id:"reset-all-filters",initialize:function(){i.view.Button.prototype.initialize.apply(this,arguments),this.controller.on("select:activate select:deactivate",this.toogleResetFilters,this)},click:function(t){"#"===this.attributes.href&&t.preventDefault(),e('.attachment-filters:has(option[value!="all"]:selected)').each(function(t){e(this).val("all").change()})},toogleResetFilters:function(){this.$el.toggleClass("hidden")}}),i.view.emlAttachmentDetailsEditMessage=i.View.extend({tagName:"div",id:"eml-save-changes-message",initialize:function(){this.text=this.options.text,this.class=this.options.class},render:function(){return this.$el.addClass(this.class),this.$el.html("<p><strong>"+this.text+"</strong></p>"),this}}),t.extend(i.view.Attachment.Details.prototype,{deleteAttachment:function(e){e.preventDefault(),window.confirm(r.warnDelete)&&(this.model.destroy(),this.controller.modal&&this.controller.modal.focusManager.focus())}}),o.AttachmentsBrowser={initialize:i.view.AttachmentsBrowser.prototype.initialize,createSidebar:i.view.AttachmentsBrowser.prototype.createSidebar,createSingle:i.view.AttachmentsBrowser.prototype.createSingle,disposeSingle:i.view.AttachmentsBrowser.prototype.disposeSingle},t.extend(i.view.AttachmentsBrowser.prototype,{initialize:function(){o.AttachmentsBrowser.initialize.apply(this,arguments),(this.controller.isModeActive("select")||this.controller.isModeActive("eml-grid"))&&(this.controller.isModeActive("eml-grid")&&(this.sidebar.$el.width(eml.l10n.grid_sidebar_width),this.on("ready",this.fixLayout,this),e(document).on("click",".notice-dismiss",t.debounce(t.bind(this.fixLayout,this),250))),this.controller.isModeActive("select")&&(this.on("ready",this.fixLayout,this),e(document).on("click",".acf-expand-details",t.bind(this.fixLayout,this)),parseInt(eml.l10n.filter_uploaded)&&"post-php"===window.adminpage&&(filters=this.toolbar.get("filters"),uploaded=filters.filters.uploaded,filters.model.set(uploaded.props))),this.$window=e(window),this.$window.on("resize",t.debounce(t.bind(this.fixLayout,this),15)),this.controller.on("sidebar:on",t.debounce(t.bind(this.scrollAttachmentIntoView,this,{block:"center"}),15)))},fixLayout:function(){if(this.controller.isModeActive("select")||this.controller.isModeActive("eml-grid")){var i=this.attachmentsWrapper||this.attachments,r=this.toolbar,l=e(".eml-media-css .updated:visible, .eml-media-css .error:visible, .eml-media-css .notice:visible, .eml-media-css .notice-error:visible, .eml-media-css .notice-warning:visible, .eml-media-css .notice-success:visible, .eml-media-css .notice-info:visible"),o=e(".eml-media-css .update-nag"),s=0;this.sidebarWidth=e(window).width()<640?0:parseInt(this.sidebar.$el.outerWidth()),o.length&&(o.css("margin-left","15px"),this.$el.closest(".wrap").css("top",o.outerHeight()+25+"px")),this.controller.isModeActive("select")&&(i.$el.css("top",r.$el.height()+10+"px"),i.$el.css("right",this.sidebarWidth.toString()+"px"),this.uploader.$el.css("top",r.$el.height()+10+"px"),this.$el.find(".eml-loader").css("top",r.$el.height()+10+"px"),r.$el.find(".media-toolbar-secondary").prepend(r.$el.find(".instructions"))),this.controller.isModeActive("eml-grid")&&(t.isUndefined(l)||l.each(function(){e(this).hasClass("update-nag")||(s+=e(this).outerHeight(!0))}),this.$el.css("top",r.$el.outerHeight()+s+15+"px"),r.$el.css("top",-r.$el.outerHeight()-25+"px"),i.$el.css("top",0))}},scrollAttachmentIntoView:function(t){var i=this.controller.state().get("selection");1==i.length&&e('li.attachment[data-id="'+i.single().get("id")+'"]')[0].scrollIntoView(t)},createToolbar:function(){var o,s,n,a=this,c=1;if(n={controller:this.controller},(this.controller.isModeActive("grid")||this.controller.isModeActive("eml-grid"))&&(n.className="media-toolbar wp-filter"),this.toolbar=new i.view.Toolbar(n),this.views.add(this.toolbar),this.toolbar.set("spinner",new i.view.Spinner({priority:-40})),(this.controller.isModeActive("grid")||this.controller.isModeActive("eml-grid"))&&(o=i.View.extend({className:"view-switch media-grid-view-switch",template:i.template("media-library-view-switcher")}),this.toolbar.set("libraryViewSwitcher",new o({controller:this.controller,priority:-90}).render())),(-1!==e.inArray(this.options.filters,["uploaded","all"])||parseInt(eml.l10n.force_filters)&&!this.controller.isModeActive("eml-bulk-edit")&&"gallery-edit"!==this.controller._state&&"playlist-edit"!==this.controller._state&&"video-playlist-edit"!==this.controller._state||"customize"===eml.l10n.current_screen||"widgets"===eml.l10n.current_screen)&&(-1===e.inArray("types",eml.l10n.filters_to_show)&&this.controller.isModeActive("eml-grid")||(this.toolbar.set("filtersLabel",new i.view.Label({value:r.filterByType,attributes:{for:"media-attachment-filters"},priority:-80}).render()),"uploaded"===this.options.filters?this.toolbar.set("filters",new i.view.AttachmentFilters.Uploaded({controller:this.controller,model:this.collection.props,priority:-80}).render()):(s=new i.view.AttachmentFilters.All({controller:this.controller,model:this.collection.props,priority:-80}),this.toolbar.set("filters",s.render()))),-1!==e.inArray("dates",eml.l10n.filters_to_show)&&i.view.settings.months.length&&(this.toolbar.set("dateFilterLabel",new i.view.Label({value:r.filterByDate,attributes:{for:"media-attachment-date-filters"},priority:-75}).render()),this.toolbar.set("dateFilter",new i.view.DateFilter({controller:this.controller,model:this.collection.props,priority:-75}).render())),eml.l10n.users.length>1&&-1!==e.inArray("authors",eml.l10n.filters_to_show)&&(this.toolbar.set("authorFilterLabel",new i.view.Label({value:eml.l10n.filter_by+" "+eml.l10n.author,attributes:{for:"author-filter"},priority:c++-70}).render()),this.toolbar.set("author-filter",new i.view.AttachmentFilters.Authors({controller:this.controller,model:this.collection.props,priority:c++-70,users:eml.l10n.users}).render())),-1!==e.inArray("taxonomies",eml.l10n.filters_to_show)&&e.each(eml.l10n.taxonomies,function(e,r){-1!==t.indexOf(eml.l10n.filter_taxonomies,e)&&r.term_list.length&&(a.toolbar.set(e+"FilterLabel",new i.view.Label({value:eml.l10n.filter_by+" "+r.plural_name,attributes:{for:"media-attachment-"+e+"-filters"},priority:c++-70}).render()),a.toolbar.set(e+"-filter",new i.view.AttachmentFilters.Taxonomy({controller:a.controller,model:a.collection.props,priority:c++-70,taxonomy:e,termList:r.term_list,singularName:r.singular_name,pluralName:r.plural_name}).render()))}),this.toolbar.$el.find(".attachment-filters").length>1&&this.toolbar.set("resetFilterButton",new i.view.Button.resetFilters({controller:this.controller,text:eml.l10n.reset_filters,disabled:!0,priority:c++-70}).render())),this.controller.isModeActive("eml-grid")){var d=this.controller.toolbar.get();e("body").hasClass("eml-pro-media-css")&&d.set("emlSelectAllButton",new i.view.emlSelectAllButton({filters:s,disabled:!0,text:eml.l10n.select_all,controller:this.controller,priority:-80}).render()),d.set("emlDeselectButton",new i.view.emlDeselectButton({filters:s,disabled:!0,text:eml.l10n.deselect,controller:this.controller,priority:-70}).render()),d.set("emlDeleteSelectedButton",new i.view.emlDeleteSelectedButton({filters:s,style:"primary",disabled:!0,text:l?r.trashSelected:r.deletePermanently,controller:this.controller,priority:-60}).render()),l&&d.set("emlDeleteSelectedPermanentlyButton",new i.view.emlDeleteSelectedPermanentlyButton({filters:s,style:"primary",disabled:!0,text:r.deletePermanently,controller:this.controller,priority:-50}).render())}(this.controller.isModeActive("grid")&&(this.toolbar.set("selectModeToggleButton",new i.view.SelectModeToggleButton({text:r.bulkSelect,controller:this.controller,priority:-70}).render()),this.toolbar.set("deleteSelectedButton",new i.view.DeleteSelectedButton({filters:s,style:"primary",disabled:!0,text:l?r.trashSelected:r.deletePermanently,controller:this.controller,priority:-60,click:function(){var i=[],o=[],s=this.controller.state().get("selection"),n=this.controller.state().get("library");s.length&&(l||window.confirm(r.warnBulkDelete))&&(l&&"trash"!==s.at(0).get("status")&&!window.confirm(r.warnBulkTrash)||(s.each(function(e){e.get("nonces").delete?l&&"trash"===e.get("status")?(e.set("status","inherit"),i.push(e.save()),o.push(e)):l?(e.set("status","trash"),i.push(e.save()),o.push(e)):e.destroy({wait:!0}):o.push(e)}),i.length?(s.remove(o),e.when.apply(null,i).then(t.bind(function(){n._requery(!0),this.controller.trigger("selection:action:done")},this))):this.controller.trigger("selection:action:done")))}}).render()),l&&this.toolbar.set("deleteSelectedPermanentlyButton",new wp.media.view.DeleteSelectedPermanentlyButton({filters:s,style:"primary",disabled:!0,text:r.deletePermanently,controller:this.controller,priority:-55,click:function(){var e=[],t=this.controller.state().get("selection");t.length&&window.confirm(r.warnBulkDelete)&&(t.each(function(t){t.get("nonces").delete?t.destroy({wait:!0}):e.push(t)}),this.controller.trigger("selection:action:done"))}}).render())),this.options.search&&(this.toolbar.set("searchLabel",new i.view.Label({value:r.searchMediaLabel,attributes:{for:"media-search-input"},priority:-30}).render()),this.toolbar.set("search",new i.view.Search({controller:this.controller,model:this.collection.props,priority:-30}).render())),this.options.dragInfo&&this.toolbar.set("dragInfo",new i.View({el:e('<div class="instructions">'+r.dragInfo+"</div>")[0],priority:-40})),"edit-attachment"!==this.controller._state)&&((d=this.controller.toolbar.get()).set("emlAttachmentSuccess",new i.view.emlAttachmentDetailsEditMessage({text:eml.l10n.saveButton_success,class:"updated",controller:this.controller,priority:200}).render()),d.set("emlAttachmentError",new i.view.emlAttachmentDetailsEditMessage({text:eml.l10n.saveButton_failure,class:"error",controller:this.controller,priority:220}).render()))},createSidebar:function(){o.AttachmentsBrowser.createSidebar.apply(this,arguments),this.controller.isModeActive("eml-grid")&&this.toggleSidebar()},toggleSidebar:function(){var e=this.controller.state().get("selection"),t=this.attachmentsWrapper||this.attachments,i=this.sidebarWidth||0;e.length?(this.sidebar.$el.removeClass("hidden"),t.$el.css("right",i.toString()+"px"),i+=10,this.uploader.$el.css("right",i.toString()+"px"),this.controller.trigger("sidebar:on")):(this.sidebar.$el.addClass("hidden"),t.$el.css("right",0),this.uploader.$el.css("right","10px"),this.controller.trigger("sidebar:off"))},createSingle:function(){if(o.AttachmentsBrowser.createSingle.apply(this,arguments),this.controller.isModeActive("eml-grid")){var e=this.sidebar,t=this.options.selection.single();"trash"!==this.options.selection.at(0).get("status")&&e.set("details",new wp.media.view.emlGridAttachmentDetails({controller:this.controller,model:t,priority:80})),this.toggleSidebar()}},disposeSingle:function(){o.AttachmentsBrowser.disposeSingle.apply(this,arguments),this.controller.isModeActive("eml-grid")&&this.toggleSidebar()},updateContent:function(){var e,t=this;e=this.controller.isModeActive("grid")||this.controller.isModeActive("eml-grid")?t.attachmentsNoResults:t.uploader,this.collection.length?(e.$el.addClass("hidden"),t.toolbar.get("spinner").hide()):(this.toolbar.get("spinner").show(),this.dfd=this.collection.more().done(function(){t.collection.length?e.$el.addClass("hidden"):e.$el.removeClass("hidden"),t.toolbar.get("spinner").hide()}))},createUploader:function(){this.uploader=new i.view.UploaderInline({controller:this.controller,status:!1,message:this.controller.isModeActive("grid")||this.controller.isModeActive("eml-grid")?"":r.noItemsFound,canClose:this.controller.isModeActive("grid")||this.controller.isModeActive("eml-grid")}),this.uploader.$el.addClass("hidden"),this.views.add(this.uploader)},createAttachments:function(){this.attachments=new i.view.Attachments({controller:this.controller,collection:this.collection,selection:this.options.selection,model:this.model,sortable:this.options.sortable,scrollElement:this.options.scrollElement,idealColumnWidth:this.options.idealColumnWidth,AttachmentView:this.options.AttachmentView}),this.controller.on("attachment:keydown:arrow",t.bind(this.attachments.arrowEvent,this.attachments)),this.controller.on("attachment:details:shift-tab",t.bind(this.attachments.restoreFocus,this.attachments)),this.attachmentsWrapper?this.views.add(".attachments-wrapper",this.attachments):this.views.add(this.attachments),(this.controller.isModeActive("grid")||this.controller.isModeActive("eml-grid"))&&(this.attachmentsNoResults=new i.View({controller:this.controller,tagName:"p"}),this.attachmentsNoResults.$el.addClass("hidden no-media"),this.attachmentsNoResults.$el.html(r.noMedia),this.views.add(this.attachmentsNoResults))}}),s={input:"onChange"},t.extend(i.view.Search.prototype,{searchTerm:"",prevTerm:"",searchDelay:1e3,timer:0,events:s,onChange:function(e){clearTimeout(this.timer),this.searchTerm=e.target.value.trim(),this.searchDelay=2e3/this.searchTerm.length;var i=this.controller.state().get("library");this.searchTerm?this.searchTerm.length>1&&(!i.length&&this.prevTerm.length&&this.searchTerm.startsWith(this.prevTerm)||(this.timer=setTimeout(t.bind(this.runSearch,this),this.searchDelay))):(this.prevTerm=this.searchTerm,this.model.unset("search"))},runSearch:function(){this.prevTerm=this.searchTerm,this.model.set("search",this.searchTerm)}}),e(document).ready(function(){e(document).on("mousedown",".media-frame .attachments-browser .attachments li",function(e){(e.ctrlKey||e.shiftKey)&&e.preventDefault()})}),e("body").addClass("eml-media-css")}(jQuery,_);