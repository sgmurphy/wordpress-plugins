import{d as J,t as M,s as P,r as v,S as W,o as m,c as k,U as X,V as Y,e as D,w as h,b as j,W as Z,X as H,u as p,Y as Q,Z as ee,a as O,f as te,h as ne,i as oe,n as ae,$ as le}from"../../index.7e5fa022.js";import{u as ie}from"../../../../common/settings-store.2e02aea6.js";import{_ as de}from"../../../../common/DataTableControl.vue_vue_type_script_setup_true_lang.ce61acc2.js";import{B as ue}from"../../../../common/index.4696b0ff.js";/* empty css                                                                                      */import{_ as se}from"../../../../common/_plugin-vue_export-helper.c27b6911.js";import"../../../../common/GroupEditFields.vue_vue_type_script_setup_true_lang.4f46f636.js";import"../../../../common/index.6ea81646.js";import"../../../../common/FormItemContext.35071f2d.js";import"../../../../common/createContext.d5228530.js";import"../../../../common/statusUtils.d389f965.js";import"../../../../common/SearchOutlined.ee7ae234.js";import"../../../../common/motion.0613b233.js";import"../../../../common/compact-item.42ee0b0f.js";import"../../../../common/index.cce61528.js";import"../../../../common/isPlainObject.3e91d860.js";import"../../../../common/_getPrototype.c0382199.js";import"../../../../common/index.1dcb9c38.js";import"../../../../common/index.262196b2.js";import"../../../../common/KeyCode.5c67594e.js";import"../../../../common/index.bde9bb0c.js";import"../../../../common/useState.ca06f0b3.js";import"../../../../common/index.0c111eb2.js";import"../../../../common/DownOutlined.bfa465e3.js";import"../../../../common/isMobile.358fd6c2.js";import"../../../../common/warning.ed311ba9.js";import"../../../../common/index.d6d25a06.js";import"../../../../common/pickAttrs.d443463a.js";import"../../../../common/slide.233af8a0.js";import"../../../../common/useMergedState.28e4599a.js";import"../../../../common/index.59e8a5e6.js";import"../../../../common/index.d7c7b51e.js";import"../../../../common/ActionButton.c1747e64.js";import"../../../../common/EditOutlined.99286c6c.js";import"../../../../common/DeleteOutlined.21f5b41a.js";import"../../../../common/index.568c686c.js";import"../../../../common/index.d80a1bbc.js";import"../../../../common/Checkbox.9e7c80aa.js";import"../../../../common/index.b4d68751.js";import"../../../../common/index.13c388c6.js";import"../../../../common/debounce.0d8c9361.js";import"../../../../common/cloneDeep.fe00636a.js";import"../../../../common/_assignValue.5ca01b62.js";const re=["id"],fe={class:"data-table-buttons"},pe={class:"data-table"},ce=J({__name:"GroupControl",props:{params:{type:Object,required:!0},conditionalValues:{type:Object,required:!1,default:()=>({})}},emits:["input","fieldData","selectedCondition","conditionalData","selectedDependent","fieldUpdatedData","fieldUpdatedPopupData"],setup(S,{emit:x}){var C,V;const B=S,{params:F}=M(B),I=ie(),{selectedConditionKey:K,selectedConditionValue:U,groupData:r}=P(I),s=F.value,A=s.classes,c=s.id,d=v(s.fields),f=W({fields:d.value}),u=v(s.table.data),N=s.group_action,w=v((V=(C=s.table)==null?void 0:C.inline_edit)!=null?V:!0),y=v(!1),l=v([]),g=v([]);if(typeof r.value<"u"&&Object.keys(r.value).length>0&&typeof r.value[c]<"u"&&(u.value=r.value[c]),f.fields)for(const[a,o]of Object.entries(f.fields)){const t=o;l.value[t.id]=t.default}const q=a=>{Object.entries(a).forEach(([o,t])=>{l.value[o]=t})};typeof d.value<"u"&&d.value!==null&&(f.fields=d.value.filter(a=>typeof a.hide<"u"&&a.hide!==null?!a.hide:!0));const E=a=>{let o="",t="";for(const[n,e]of Object.entries(a)){let i=e;o=n,t=i}f.fields=d.value.filter(n=>{if(typeof n.condition<"u"&&n.condition!==null){const e=n.condition.find(i=>i.key===o);return e.value==="yes"&&t==="yes"?!0:e.value==="no"&&t==="no"}else return!0}),g.value[o]=t},G=a=>{Object.assign(u.value.filter(o=>a.key===o.key)[0],a),r.value[c]=u.value},R=a=>{u.value=u.value.filter(o=>o.key!==a),r.value[c]=u.value},$=a=>{let o="",t="";for(const[n,e]of Object.entries(a)){let i=e;o=n,t=i}f.fields=d.value.filter(n=>{const e=d.value.find(i=>i.id===n.id);if(e)if(typeof e.condition<"u"&&e.condition!==null){const i=e.condition.find(_=>_.key===o);return typeof i<"u"&&i.key===o&&(!Array.isArray(i.value)&&i.value===t||Array.isArray(i.value)&&i.value.includes(t))?(typeof l.value[e.id]<"u"&&l.value[e.id]!==null&&(n.default=l.value[e.id]),typeof e.dependent_option<"u"&&e.dependent_option!==null&&(n.default=e.dependent_default),!0):!1}else return typeof l.value[e.id]<"u"&&l.value[e.id]!==null&&(n.default=l.value[e.id]),typeof e.dependent_option<"u"&&e.dependent_option!==null&&(n.default=e.dependent_default),!0;else return!1})},L=a=>{f.fields=d.value.filter(o=>{const t=d.value.find(n=>n.id===o.id);return t?typeof t.hide<"u"&&t.hide!==null&&t.hide?!1:(typeof l.value[t.id]<"u"&&l.value[t.id]!==null&&(o.default=l.value[t.id]),typeof t.dependent_option<"u"&&t.dependent_option!==null&&(o.default=t.dependent_default),!0):!1})},T=async()=>{y.value=!0;const a=[{key:"action",value:N}],o={};let t=0;if(u.value.length>0){let n=u.value.map(i=>i.key);t=Math.max(...n)+1}o.key=t;for(const[n,e]of Object.entries(l.value)){let i=e;typeof e=="object"&&e!==null&&(i=JSON.stringify(e)),a.push({key:n,value:i});let _=e;const b=d.value.find(z=>z.id===n);typeof b<"u"&&typeof b.prefix<"u"&&(_=b.prefix+e),o[n]=_}l.value=[];try{await le(a)==="success"&&(u.value.push(o),r.value[c]=u.value,K.value="",U.value="",w.value||x("fieldUpdatedData",o)),y.value=!1}catch(n){console.error(n)}finally{y.value=!1}};return(a,o)=>(m(),k("div",{id:p(c),class:ae(p(A))},[(m(!0),k(X,null,Y(f.fields,(t,n)=>(m(),k("div",{key:n},[(m(),D(ee,null,{fallback:h(()=>[j(Z)]),default:h(()=>[(m(),D(H(p(Q)(t.type)),{params:t,"conditional-values":g.value,onFieldData:q,onConditionalData:E,onSelectedCondition:$,onSelectedDependent:L},null,40,["params","conditional-values"]))]),_:2},1024))]))),128)),O("div",fe,[p(s).button_label!==""?(m(),D(p(ue),{key:0,type:"primary",class:"save-group-btn",loading:y.value,onClick:T},{default:h(()=>[te(ne(p(s).button_label),1)]),_:1},8,["loading"])):oe("",!0)]),O("div",pe,[j(de,{params:p(s).table,data:u.value,"edit-fields":d.value,onFieldUpdatedData:G,onFieldDeletedData:R},null,8,["params","data","edit-fields"])])],10,re))}}),ot=se(ce,[["__scopeId","data-v-ac0e52be"]]);export{ot as default};
