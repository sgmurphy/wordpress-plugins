import{b as k,a0 as Y,d as Z,t as K,r as m,S as ee,o as l,e as j,w as A,c as u,a as _,U as h,u as i,f as b,R as te,i as V,h as g,p as $,n as ae,$ as x}from"../apps/settings/index.7e5fa022.js";import{_ as ne}from"./GroupEditFields.vue_vue_type_script_setup_true_lang.4f46f636.js";import{A as M}from"./index.59e8a5e6.js";import{E as se}from"./EditOutlined.99286c6c.js";import{D as oe}from"./DeleteOutlined.21f5b41a.js";import{A as le}from"./index.568c686c.js";import{c as ie}from"./cloneDeep.fe00636a.js";var re={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"};const ce=re;function U(c){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?Object(arguments[s]):{},p=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(p=p.concat(Object.getOwnPropertySymbols(r).filter(function(v){return Object.getOwnPropertyDescriptor(r,v).enumerable}))),p.forEach(function(v){de(c,v,r[v])})}return c}function de(c,s,r){return s in c?Object.defineProperty(c,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):c[s]=r,c}var w=function(s,r){var p=U({},s,r.attrs);return k(Y,U({},p,{icon:ce}),null)};w.displayName="SaveOutlined";w.inheritAttrs=!1;const ue=w,fe={key:0,class:"editable-row-operations"},pe={class:"editable-cell"},ve=["loading","onClick"],ye=["onClick"],me={key:0},_e=["innerHTML"],be={key:1},ke=["innerHTML"],Ae=Z({__name:"DataTableControl",props:{params:{type:Object,required:!0},data:{type:Object,required:!0},editFields:{type:Object,required:!1,default:()=>({})}},emits:["fieldData","fieldUpdatedData","fieldUpdatedPopupData","fieldDeletedData"],setup(c,{emit:s}){var P,T;const r=c,{params:p,data:v,editFields:z}=K(r),f=p.value,L=m((P=f.paginated)!=null?P:!1),N=f.fields,B=m(f.classes),O=m(v),E=f.editable,q=f.can_delete,F=f.edit_action,I=f.delete_action,D=m((T=f.inline_edit)!=null?T:!0),S=m(!1),d=ee([]),C=m([]),R=e=>{for(const[o,a]of Object.entries(e))C.value[o]=a},J=e=>{d[e]=ie(O.value.filter(o=>e===o.key)[0]),C.value=d[e],D.value===!1?s("fieldUpdatedPopupData",d[e]):s("fieldUpdatedData",d[e])},G=async e=>{const o=[{key:"action",value:F}],a={};a.key=e;for(const[t,n]of Object.entries(C.value)){let y=n;typeof n=="object"&&n!==null&&(y=JSON.stringify(n)),o.push({key:t,value:y}),a[t]=n}try{await x(o)==="success"&&s("fieldUpdatedData",a)}catch(t){console.error(t)}finally{S.value=!1}delete d[e]},Q=async e=>{const o=O.value.filter(t=>e===t.key)[0],a=[{key:"action",value:I}];for(const[t,n]of Object.entries(o))a.push({key:t,value:n});try{await x(a)==="success"&&s("fieldDeletedData",e)}catch(t){console.error(t)}finally{S.value=!1}},W=e=>{delete d[e]},X=e=>{const o=[];for(const[a,t]of Object.entries(z.value))o[t.id]=t;return typeof o[e]<"u"?o[e]:{}},H=e=>Array.isArray(e)?e.join(", "):e;return(e,o)=>(l(),j(i(le),{class:ae(B.value),"data-source":O.value,columns:i(N),pagination:L.value,bordered:""},{bodyCell:A(({column:a,text:t,record:n})=>[a.key==="operation"?(l(),u("div",fe,[_("div",pe,[d[n.key]&&D.value?(l(),u(h,{key:0},[_("a",{loading:S.value,onClick:y=>G(n.key)},[k(i(ue))],8,ve),b("   "),k(i(M),{title:"Sure to cancel?",onConfirm:y=>W(n.key)},{default:A(()=>[_("a",null,[k(i(te))])]),_:2},1032,["onConfirm"])],64)):(l(),u(h,{key:1},[i(E)?(l(),u("a",{key:0,onClick:y=>J(n.key)},[k(i(se))],8,ye)):V("",!0),b("   "),i(q)?(l(),u(h,{key:1},[O.value.length?(l(),j(i(M),{key:0,title:"Sure to delete?",onConfirm:y=>Q(n.key)},{default:A(()=>[_("a",null,[k(i(oe))])]),_:2},1032,["onConfirm"])):V("",!0)],64)):V("",!0)],64))])])):(l(),u(h,{key:1},[D.value?(l(),u("div",me,[d[n.key]?(l(),j(ne,{key:0,"editable-data":d[n.key],"field-value":d[n.key][a.dataIndex],"field-data":X(a.field),onFieldUpdatedData:R},null,8,["editable-data","field-value","field-data"])):(l(),u(h,{key:1},[b(g(a.prefix)+" ",1),_("span",{innerHTML:i($)(H(t))},null,8,_e),b(" "+g(a.suffix),1)],64))])):(l(),u("div",be,[b(g(a.prefix)+" ",1),_("span",{innerHTML:i($)(H(t))},null,8,ke),b(" "+g(a.suffix),1)]))],64))]),_:1},8,["class","data-source","columns","pagination"]))}});export{Ae as _};
