(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{1284:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a(5),c=a(1),s=a(4),o=a(9),i=a.n(o),m=a(946),l=a(953),b=a(45),u=a.n(b),d=a(3),p=a(984),w=a(181),f=a(49),O=a(8),j=a(66),v=a(74),g=a(311),E=a(16),y=a(39),h=a(53);function _(e,t,a,r,n,c,s){try{var o=e[c](s),i=o.value}catch(e){return void a(e)}o.done?t(i):Promise.resolve(i).then(r,n)}function N(e){return function(){var t=this,a=arguments;return new Promise((function(r,n){var c=e.apply(t,a);function s(e){_(c,r,n,s,o,"next",e)}function o(e){_(c,r,n,s,o,"throw",e)}s(void 0)}))}}function k(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,c=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,c=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw c}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return S(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}t.default=function(e){var t=Object(r.useContext)(s.h),a=k(Object(r.useState)(!1),2),o=a[0],b=a[1],_=k(Object(r.useState)(1),2),S=_[0],x=_[1],C=k(Object(r.useState)(""),2),T=C[0],P=C[1],H=k(Object(r.useState)({loading:!1,error:!1,success:!1,message:""}),2),I=H[0],M=H[1],A=Object(r.useRef)(),D=k(Object(r.useState)(!1),2),R=D[0],Y=D[1],L=k(Object(r.useState)(!1),2),B=L[0],F=L[1],U=k(Object(r.useState)(!0),2),z=U[0],J=U[1],W=k(Object(r.useState)(!1),2),q=W[0],G=W[1],V=k(Object(r.useState)({}),2),K=V[0],$=V[1],Q=k(Object(r.useState)(!1),2),X=Q[0],Z=Q[1],ee=k(Object(r.useState)({message:"",type:1}),2),te=ee[0],ae=ee[1],re=Object(l.a)().setCampaignValues,ne=Object(s.C)(),ce=m.a.getCampaignData(),se=m.a.getCampaignId(),oe=(m.a.getEditableMode(),parseInt(ce.type));Object(r.useEffect)((function(){!function(){if(ce.data&&ce.data.content&&ce.data.content.length>0){var e=!0;ce.data.content.map((function(t,a){ce.hasOwnProperty("validated_email_body_".concat(a))&&!ce["validated_email_body_".concat(a)]&&(e=!1)})),F(e)}}()}),[ce]),Object(r.useEffect)((function(){if(ce)if(ce.hasOwnProperty("execution_time")&&!Object(d.isNull)(ce.execution_time))x(2),P(u()(Object(s.W)(ce.execution_time,!0,!0,!1)).format("YYYY-MM-DDTHH:mm:ss"));else{var e=Object(s.H)(u()(new Date)).format("YYYY-MM-DDTHH:mm:ss");P(e)}}),[]),Object(r.useEffect)((function(){document.addEventListener("click",(function(e){var t=document.getElementsByClassName("bwf-crm-campaign-schedule-popover")[0],a=!0;void 0!==t&&t.contains(e.target)&&(a=!1),o&&"bwf-crm-campaign-review-schedule-text-box"!=e.target.id&&a&&b(!1)}))}));var ie=Object(v.a)().setL2Title;Object(r.useEffect)((function(){ie("title"in ce?Object(r.createElement)(r.Fragment,null,ce.title):"")}),[ce]);var me=ce?ce.count:0,le=[{value:1,className:"bwf-crm-campaign-schedule bwf-crm-campaign-schedule-now",label:Object(c.__)("Broadcast Now","wp-marketing-automations")},{value:2,className:"bwf-crm-campaign-schedule bwf-crm-campaign-schedule-later",label:Object(c.__)("Schedule For Later","wp-marketing-automations")}],be=function(){var a=N(regeneratorRuntime.mark((function a(){var r,n;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e.setPending(!0),!(me<=0)){a.next=5;break}return M({status:!0,error:Object(c.__)("No Contacts are selected.","wp-marketing-automations")}),e.setPending(!1),a.abrupt("return");case 5:if(r=Object(s.H)(u()(new Date)).format("YYYY-MM-DDTHH:mm:ss"),n=Object(s.H)(u()(T)),2!=S||n.isAfter(r)||n.isSame(r,"minute")){a.next=11;break}return M({status:!0,error:Object(c.__)("Given time should exceeds the current time.","wp-marketing-automations")}),e.setPending(!1),a.abrupt("return");case 11:return a.prev=11,a.next=14,i()({path:Object(s.u)("/broadcast/".concat(se)),method:"POST",data:{data:{schedule_time:2==S?Object(s.K)(T).utc().format():"",modified_by:Object(s.G)()},step:4},headers:{"Content-Type":"application/json"}}).then((function(e){200==e.code?(t(e.message),Object(s.wb)(t,3e3),setTimeout((function(){re("data",e.result),re("editableMode",!1)}),2e3)):M({status:!0,error:e.message})}));case 14:a.next=19;break;case 16:a.prev=16,a.t0=a.catch(11),M({status:!0,error:a.t0.message});case 19:e.setPending(!1);case 20:case"end":return a.stop()}}),a,null,[[11,16]])})));return function(){return a.apply(this,arguments)}}(),ue=function(){var e=N(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,J(!0),e.next=4,i()({path:Object(s.u)("/broadcast/email-preview"),method:"POST",data:t}).then((function(e){G(e.result.body.replace(/\\/g,"")),J(!1)}));case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",Object(r.createElement)(r.Fragment,null));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),de=function(e){var t="",a=!1;return 3==oe?e.hasOwnProperty("whatsAppImage")&&e.whatsAppImage&&e.hasOwnProperty("whatsAppImageSetting")&&e.whatsAppImageSetting.hasOwnProperty("position")&&!Object(d.isEmpty)(e.whatsAppImageSetting.position)&&e.whatsAppImageSetting.hasOwnProperty("imageURL")&&!Object(d.isEmpty)(e.whatsAppImageSetting.imageURL)&&(t="before"===e.whatsAppImageSetting.position?Object(r.createElement)(r.Fragment,null,Object(r.createElement)("img",{src:e.whatsAppImageSetting.imageURL,width:50,height:50}),Object(r.createElement)("div",{dangerouslySetInnerHTML:{__html:e.body}})):Object(r.createElement)(r.Fragment,null,Object(r.createElement)("div",{dangerouslySetInnerHTML:{__html:e.body}}),Object(r.createElement)("img",{src:e.whatsAppImageSetting.imageURL,width:50,height:50})),a=!1):2==oe&&(a=!0),a?(t=Object(r.createElement)("div",{dangerouslySetInnerHTML:{__html:"editor"===e.type?e.editor.body:e.body}}),G(t),J(!1)):ue({content:"editor"===e.type?e.editor.body:e.body,type:e.type}),e.mode=ce.type,e};return Object(r.createElement)(r.Fragment,null,Object(r.createElement)(f.a,null),Object(r.createElement)("div",{className:"bwf-campaign-step-div bwf-card-wrap bwf-campaign-step-4"},Object(r.createElement)("div",{className:"bwf-card-header"},Object(r.createElement)("span",{className:"bwf-form-title"},Object(c.__)("Review & Schedule","wp-marketing-automations"))),Object(r.createElement)("div",{className:""},Object(r.createElement)("div",{className:"bwf-p-gap bwf-top-gap"},Object(r.createElement)("div",{className:"bwf-crm-overview-detail-wrap"},Object(r.createElement)("div",{className:"bwf-crm-overview-report-header bwf-heading3-new"},Object(c.__)("Information","wp-marketing-automations")),Object(r.createElement)(n.CardBody,{className:"bwf-crm-overview-report-body"},Object(r.createElement)("div",{className:"bwf-report-row",key:1},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("Title","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},ce.title)),Object(r.createElement)("div",{className:"bwf-report-row",key:2},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("Type","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},ne[oe].label)),!!ce.description&&Object(r.createElement)("div",{className:"bwf-report-row",key:3},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("Description","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},ce.description)))))),Object(r.createElement)("div",{className:"bwf-pt-0"},Object(r.createElement)("div",{className:"bwf-p-gap "},Object(r.createElement)(r.Fragment,null,Object(r.createElement)("div",{className:"bwf-crm-overview-detail-wrap"},Object(r.createElement)("div",{className:"bwf-crm-overview-report-header bwf-heading3-new"},Object(c.__)("Contacts","wp-marketing-automations")),Object(r.createElement)(n.CardBody,{className:"bwf-crm-overview-report-body"},Object(r.createElement)("div",{className:"bwf-report-row",key:1},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("Total","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},Object(r.createElement)("b",null,me))),ce.data.hasOwnProperty("filters")&&!Object(d.isEmpty)(ce.data.filters)&&Object(r.createElement)("div",{className:"bwf-report-row",key:2},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("Segments","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},Object(p.b)(ce.data.filters)))))))),Object(r.createElement)("div",{className:" bwf-pt-0"},Object(r.createElement)("div",{className:"bwf-p-gap "},Object(r.createElement)("div",{className:"bwf-crm-overview-detail-wrap"},Object(r.createElement)("div",{className:"bwf-crm-overview-report-header bwf-heading3-new"},Object(c.__)("Content","wp-marketing-automations")),Object(r.createElement)(n.CardBody,{className:"bwf-crm-overview-report-body"},oe&&1==oe&&ce.data.hasOwnProperty("senders_name")&&!Object(d.isEmpty)(ce.data.senders_name)&&Object(r.createElement)("div",{className:"bwf-report-row",key:1},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("From Name","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},ce.data.senders_name)),oe&&1==oe&&ce.data.hasOwnProperty("senders_email")&&!Object(d.isEmpty)(ce.data.senders_email)&&Object(r.createElement)("div",{className:"bwf-report-row",key:2},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("From Email","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},ce.data.senders_email)),oe&&1==oe&&ce.data.hasOwnProperty("replyto")&&!Object(d.isEmpty)(ce.data.replyto)&&Object(r.createElement)("div",{className:"bwf-report-row",key:3},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("Reply-To Email","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},ce.data.replyto)),ce.data&&ce.data.content&&ce.data.content.map((function(e,t){return Object(r.createElement)("div",{className:"bwf-report-row",key:t},Object(r.createElement)("div",{className:"bwf-report-row-label"},ce.data.content.length>1?Object(c.__)("Content #","wp-marketing-automations")+(parseInt(t)+1):Object(c.__)("Content","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value bwf-report-value-modal"},oe&&e.subject&&Object(r.createElement)("span",null,e.subject),Object(r.createElement)(E.a,{isTertiary:!0,className:"bwf-btn-small is-light",onClick:N(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Y(!0),t.next=3,de(e);case 3:a=t.sent,$(a);case 5:case"end":return t.stop()}}),t)})))},Object(c.__)("View details","wp-marketing-automations")),ce.hasOwnProperty("validated_email_body_".concat(t))&&!ce["validated_email_body_".concat(t)]&&Object(r.createElement)("div",{className:"bwf-error"},Object(c.__)("Something is wrong with the HTML of email body. Please review the HTML for any syntax errors.","wp-marketing-automations"))))})),!!ce.data&&ce.data.hasOwnProperty("smart_send")&&ce.data.smart_send.hasOwnProperty("enable")&&ce.data.smart_send.enable&&Object(r.createElement)(r.Fragment,null,Object(r.createElement)("div",{className:"bwf-report-row",key:11},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("Smart sending","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},Object(c.__)("Enabled","wp-marketing-automations"))),Object(r.createElement)("div",{className:"bwf-report-row",key:12},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("Sample size (in percent)","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},ce.data.smart_send.percent+" %")),Object(r.createElement)("div",{className:"bwf-report-row",key:13},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(c.__)("Wait Time (in hours)","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},ce.data.smart_send.hours+" "+Object(c.__)("hours","wp-marketing-automations")))))))),Object(r.createElement)("div",{className:"bwf-pt-0"},Object(r.createElement)("div",{className:"bwf-p-gap "},Object(r.createElement)("div",{className:"bwf-crm-overview-detail-wrap"},Object(r.createElement)("div",{className:"bwf-crm-overview-report-header bwf-heading3-new"},Object(c.__)("Schedule","wp-marketing-automations")),Object(r.createElement)(n.CardBody,{className:"bwf-crm-overview-schedule-section"},Object(r.createElement)("div",{className:"bwf-campaign-review-broadcast-wrap",onClick:function(){b(!1)}},Object(r.createElement)("div",{className:"bwf-display-flex gap--8 bwf-flex-start"},le.map((function(e,t){return Object(r.createElement)(E.a,{onClick:function(){x(e.value)},isSecondary:e.value===S,isTertiary:e.value!==S,className:"bwf-btn-small "+(e.value===S?"is-border is-blue-bg":""),key:t},1==e.value?Object(r.createElement)("span",{className:"bwf-rotate-90 bwf-pt-8"},Object(r.createElement)(O.a,{icon:"broadcasts",size:16,color:e.value===S?"#fff":"#000"})):Object(r.createElement)(O.a,{icon:"timer",size:16,color:e.value===S?"#fff":"#000"}),e.label)}))),2==S&&Object(r.createElement)("div",{className:"bwf-crm-campaign-review-date-wrap"},Object(r.createElement)("div",{className:"bwf-display-flex bwf-flex-start"},Object(r.createElement)(O.a,{icon:"calender"}),Object(r.createElement)("span",null,Object(c.__)("Pick Date and Time","wp-marketing-automations"))),Object(r.createElement)("div",{className:"bwf-crm-campaign-review-schedule-text-box",id:"bwf-crm-campaign-review-schedule-text-box",onClick:function(e){e.stopPropagation(),b(!o)}},Object(s.W)(u()(T),!1,!1),o&&Object(r.createElement)(h.a,{ref:A,position:"top",shift:!0,focusOnMount:!0,onFocusOutside:function(e){b(!1)}},Object(r.createElement)("div",{className:"bwf-crm-campaign-schedule-popover",onClick:function(e){return e.stopPropagation()}},Object(r.createElement)(n.DateTimePicker,{currentDate:T,isInvalidDate:function(e){return Object(s.H)(e).isBefore(Object(s.H)(u()()),"day")},onChange:function(e,t){var a=Object(s.H)(u()(new Date)).format("YYYY-MM-DDTHH:mm:ss"),r=Object(s.H)(u()(e));r.isAfter(a)||r.isSame(a,"minute")?P(e):ae({message:Object(c.__)("Given time should exceeds the current time.","wp-marketing-automations"),type:0})},is12Hour:!0}),Object(r.createElement)("div",{className:"bwf-p-0 bwf-m-0 bwf-display-flex bwf-mt-8"},Object(c.__)("Current Store Time","wp-marketing-automations")+": ",Object(s.W)(u()().tz("UTC")))))))))))),Object(r.createElement)("div",{className:"bwf-p-gap bwf-pt-0"},Object(r.createElement)("div",{className:"bwf-crm-campaign-navigation"},Object(r.createElement)(E.a,{isSecondary:!0,className:"bwf-crm-navigation-previous",onClick:function(){re("step",3)}},Object(c.__)("Previous","wp-marketing-automations")),Object(r.createElement)(E.a,{className:"bwf-crm-navigation-next",isPrimary:!0,disabled:!B,onClick:function(){Object(s.Jb)()?be():Z(!0)},isBusy:e.isPending},!Object(s.Jb)()&&Object(r.createElement)(O.a,{icon:"king",color:"#fff",size:16}),1===S?Object(c.__)("Send Now","wp-marketing-automations"):Object(c.__)("Schedule","wp-marketing-automations")))),Object(r.createElement)(g.a,{isOpen:R,isLoading:z,onRequestClose:function(){return Y(!1)},subject:K.subject,preHeader:K.preheader,body:q,type:K.type,sourceType:2,mode:ce.type,utm:K.utm}),Object(r.createElement)(j.a,{modalTitle:Object(c.__)("Update Broadcast","wp-marketing-automations"),confirmText:I.confirmText,deleteEntityName:I.deleteEntityName,confirmButtonText:I.buttonConfirm,cancelButtonText:I.buttonCancel,onConfirm:I.onConfirm,isLoading:I.loading,successMessage:I.success,errorMessage:I.error,onRequestClose:function(){return M({status:!1})},isOpen:I.status,isDelete:!0}),Object(r.createElement)(w.a,{message:te.message,type:te.type,removeMessage:function(){return ae({message:"",type:1})}})),!Object(s.Jb)()&&Object(r.createElement)(y.b,{isOpen:X,onRequestClose:function(){return Z(!1)},modalContent:{isFeature:!0,featureTitle:Object(c.__)("Broadcast","wp-marketing-automations")}}))}}}]);