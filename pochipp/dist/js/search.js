(()=>{const t=(t,e)=>{if(t.error)return`<div class="pochipp-items--error"><p>${t.error.code}: ${t.error.message}</p><p>エラーの内容については<a href="https://pochipp.com/590/" target="_blank">公式記事</a>もご覧ください</p></div>`;let a="";return Object.keys(t).forEach((o=>{const r=t[o],i=Number(r.price),n=r.searched_at,p=r.asin?"https://www.amazon.co.jp/dp/"+r.asin:"",s=r.rakuten_detail_url||"",c=r.yahoo_detail_url||"";let l="";p&&(l=`<a href="${p}" class="button" rel="nofollow noopener noreferrer" target="_blank">Amazon商品ページを確認</a>`);let d="";s&&(d=`<a href="${s}" class="button" rel="nofollow noopener noreferrer" target="_blank">楽天商品ページを確認</a>`);let _="";c&&(_=`<a href="${c}" class="button" rel="nofollow noopener noreferrer" target="_blank">Yahooショッピング商品ページを確認</a>`);let h="";r.info&&(h=`<div class='pochipp-item__info'>${r.info}</div>`);let m="";r.price&&(m=`<div class="pochipp-item__price">価格：¥${i.toLocaleString()}</div>`);let u=r.image_url;const f=r.custom_image_url||"";if(f?u=f:u&&("rakuten"===n&&(u+="?_ex=100x100"),"amazon"===n&&(u=u.replace(".jpg","._SL100_.jpg"))),a+=`<div class="pochipp-item" data-index="${o}" data-type="${e}">\n\t\t\t<div class="pochipp-item__img">\n\t\t\t\t<img src="${u}" alt="" />\n\t\t\t</div>\n\t\t\t<div class="pochipp-item__body">\n\t\t\t\t<div class="pochipp-item__title">${r.title}</div>\n\t\t\t\t${h}\n\t\t\t\t${m}\n\t\t`,"registerd"===e){const t=`${window.pochippIframeVars.adminUrl}post.php?post=${r.post_id}&action=edit`;a+=`<div class="pochipp-item__btns">\n\t\t\t\t<button class="button button-primary" data-pochipp="select">この商品を選択</button>\n\t\t\t\t${l}${d}${_}\n\t\t\t\t<a class="button" data-pochipp="edit" href="${t}" rel="nofollow noreferrer" target="_blank">この商品を編集</a>\n\t\t\t</div>`}else a+=`<div class="pochipp-item__btns">\n\t\t\t\t<button class="button button-primary" data-pochipp="select">この商品を選択</button>\n\t\t\t\t${l}${d}${_}\n\t\t\t</div>`;a+="</div></div>"})),a};!function(e){const a=a=>{const{ajaxUrl:o,blockId:r,calledAt:i,only:n}=window.pochippIframeVars;e("#result_area").html(""),a.term_id=e("#term_select").val(),a.only=n;const p=window.pchppVars.ajaxNonce;a.nonce=p,e.ajax({url:o,dataType:"json",data:a,beforeSend:()=>{e("#loading_image").show()}}).done((function(a){if(a.error)return void e("#result_area").html(`<div><p>${a.error.code}: ${a.error.message}</p><p>エラーの内容については<a href="https://pochipp.com/590/" target="_blank">公式記事</a>もご覧ください</p></div>`);const o=a.searched_items,p=a.registerd_items,s=((e,a,o)=>{let r="";if("editor"===o){const e=t(a,"registerd");e&&(r+=`<div class="pchpp-tb__area-title">登録済み商品</div><div class="pochipp-items">${e}</div>`)}const i=t(e,"searched");return i&&(r+=`<div class="pchpp-tb__area-title">検索結果</div><div class="pochipp-items">${i}</div>`),r})(o,p,i);e("#result_area").html(s),e('[data-pochipp="select"]').click((function(){const t=e(this).parents(".pochipp-item"),a=t.attr("data-index"),s="registerd"===t.attr("data-type")?p[a]:o[a];if(n){const t={};"amazon"===n?(t.asin=s.asin||"",t.amazon_affi_url=s.amazon_affi_url||""):"rakuten"===n?(t.itemcode=s.itemcode||"",t.rakuten_detail_url=s.rakuten_detail_url||""):"yahoo"===n&&(t.yahoo_itemcode=s.yahoo_itemcode||"",t.yahoo_detail_url=s.yahoo_detail_url||"",t.seller_id=s.seller_id||""),"editor"===i?window.top.set_block_data_at_editor(t,r):window.top.setItemMetaData(t,!0)}else"editor"===i?window.top.set_block_data_at_editor(s,r):window.top.setItemMetaData(s,!1);window.parent.tb_remove()}))})).always((function(){e("#loading_image").hide()}))};!function(){const{tabKey:t}=window.pochippIframeVars;e("#keywords").focus(),"pochipp_search_registerd"===t&&a({action:t,count:"5"}),e("#search_form").submit((function(o){o.preventDefault();const r=t||"";if(!r)return void e("#result_area").html("<p>エラー : アクション名が不明です。</p>");const i="pochipp_search_registerd"!==r,n=e("#keywords").val();if(!i||n)return a({action:r,keywords:n}),!1;e("#result_area").html("<p>キーワードを入力して下さい。</p>")}))}()}(window.jQuery)})();