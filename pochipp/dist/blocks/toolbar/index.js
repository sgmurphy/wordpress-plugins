(()=>{"use strict";const e=window.wp.element,t=window.wp.richText,o=window.wp.blockEditor,n=window.wp.components,r=window.wp.primitives,c=(0,e.createElement)(r.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,e.createElement)(r.Path,{d:"M19 6.5H5c-1.1 0-2 .9-2 2v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7c0-1.1-.9-2-2-2zm.5 9c0 .3-.2.5-.5.5H5c-.3 0-.5-.2-.5-.5v-7c0-.3.2-.5.5-.5h14c.3 0 .5.2.5.5v7zM8 13h8v-1.5H8V13z"})),i=(0,e.createElement)(r.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)(r.Path,{d:"M15.6 7.2H14v1.5h1.6c2 0 3.7 1.7 3.7 3.7s-1.7 3.7-3.7 3.7H14v1.5h1.6c2.8 0 5.2-2.3 5.2-5.2 0-2.9-2.3-5.2-5.2-5.2zM4.7 12.4c0-2 1.7-3.7 3.7-3.7H10V7.2H8.4c-2.9 0-5.2 2.3-5.2 5.2 0 2.9 2.3 5.2 5.2 5.2H10v-1.5H8.4c-2 0-3.7-1.7-3.7-3.7zm4.6.9h5.3v-1.5H9.3v1.5z"}));var p=(0,e.createElement)(r.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,e.createElement)(r.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM5 4.5h14c.3 0 .5.2.5.5v8.4l-3-2.9c-.3-.3-.8-.3-1 0L11.9 14 9 12c-.3-.2-.6-.2-.8 0l-3.6 2.6V5c-.1-.3.1-.5.4-.5zm14 15H5c-.3 0-.5-.2-.5-.5v-2.4l4.1-3 3 1.9c.3.2.7.2.9-.1L16 12l3.5 3.4V19c0 .3-.2.5-.5.5z"}));function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!==a(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,"string");if("object"!==a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===a(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}const m=function(t){var o=t.icon,n=t.size,r=void 0===n?24:n,c=function(e,t){if(null==e)return{};var o,n,r=function(e,t){if(null==e)return{};var o,n,r={},c=Object.keys(e);for(n=0;n<c.length;n++)o=c[n],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(n=0;n<c.length;n++)o=c[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}(t,["icon","size"]);return(0,e.cloneElement)(o,function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?s(Object(o),!0).forEach((function(t){l(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):s(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({width:r,height:r},c))},u=async({keywords:e,count:t})=>{const{ajaxUrl:o,ajaxNonce:n}=window.pchppVars,r={action:"pochipp_search_registerd",nonce:n,count:t};e&&(r.keywords=e);const c=new URLSearchParams(r);return(await fetch(`${o}?${c}`,{method:"GET",cache:"no-cache"}).then((e=>{if(e.ok)return e.json();throw new TypeError("Failed ajax!")}))).registerd_items.map((e=>({pid:e.post_id,title:e.title,image:e.custom_image_url||e.image_url,customBtnText:e.custom_btn_text||"",customBtnUrl:e.custom_btn_url||"",customBtnText2:e.custom_btn_text_2||"",customBtnUrl2:e.custom_btn_url_2||""})))},h={amazon:"Amazon",rakuten:"楽天",yahoo:"Yahoo",mercari:"メルカリ",custom1:"カスタムボタン",custom2:"カスタムボタン2"},v={button:"pochipp_btn",link:"pochipp_link",img:"pochipp_img"},d=(e,t)=>"custom1"===e?t.customBtnText:"custom2"===e?t.customBtnText2:h[e],y=({selectedType:o,value:r,item:c,onChange:i,closePopover:p})=>{const{hasAffi:a}=window.pchppVars,l=void 0!==window.pchppProVars,s=a&&Object.values(a).every((e=>""===e)),m=l?` cvkey="${Array.from(Array(8)).map((()=>"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"[Math.floor(62*Math.random())])).join("")}"`:"";return(0,e.createElement)("div",{className:"pochipp-popover__card"},(0,e.createElement)("div",{className:"pochipp-popover__card-image"},(0,e.createElement)("img",{src:c.image,width:100,height:100,alt:""})),(0,e.createElement)("div",{className:"pochipp-popover__card-body"},(0,e.createElement)("p",{className:"pochipp-popover__card-description"},c.title),(0,e.createElement)("div",{className:"pochipp-popover__card-btns"},s&&(0,e.createElement)("div",{className:"pochipp-popover__disabled"},(0,e.createElement)("a",{href:"https://pochipplocal.local/wp-admin/edit.php?post_type=pochipps&page=pochipp_settings&tab=basic"},"ポチップ設定ページ"),"から、各ショップの「アフィリエイト設定」を行ってください。"),Object.keys(h).map((l=>((e,t,o)=>"custom1"===e?o.customBtnText&&o.customBtnUrl:"custom2"===e?o.customBtnText2&&o.customBtnUrl2:t&&t[e])(l,a,c)&&(0,e.createElement)(n.Button,{key:`btn-${l}`,text:d(l,c),isSecondary:!0,onClick:()=>{p(),i((0,t.insert)(r,((e,t,o,n,r)=>{const c=v[e],i=h[r];switch(e){case"button":return`[${c} id="${t}" shop="${r}"${n}]${i}[/${c}]`;case"link":return`[${c} id="${t}" shop="${r}"${n}]${o}[/${c}]`;case"img":return`[${c} id="${t}" shop="${r}"${n}]`;default:return""}})(o,c.pid,c.title,m,l),r.start,r.end))}}))))))},w={button:{icon:c,title:"Pochipp インラインボタン"},link:{icon:i,title:"Pochipp インラインリンク"},img:{icon:p,title:"Pochipp インライン画像"}},f=({selectedType:t,value:o,anchorRef:r,onChange:c,closePopover:i})=>{const[p,a]=(0,e.useState)([]),[l,s]=(0,e.useState)(""),{title:h,icon:v}=w[t];return(0,e.useEffect)((()=>{(async()=>{a(await u({keywords:null,count:5}))})()}),[]),(0,e.createElement)(n.Popover,{anchorRef:r,className:"pochipp-popover",onClose:()=>{i()}},(0,e.createElement)("div",{className:"pochipp-popover__title"},(0,e.createElement)(m,{icon:v}),(0,e.createElement)("span",null,h)),(0,e.createElement)("div",{className:"pochipp-popover__body"},(0,e.createElement)(n.TextControl,{className:"pochipp-popover__search",placeholder:"登録済み商品をキーワードで検索...",value:l,onChange:e=>{s(e),(async e=>{a(await u({keywords:e,count:5}))})(l)}}),(0,e.createElement)("div",{className:"pochipp-popover__list"},p.map((n=>(0,e.createElement)(y,{key:n.pid,selectedType:t,value:o,item:n,onChange:c,closePopover:i}))))))},b=[{title:"インラインボタン",type:"button"},{title:"インラインリンク",type:"link"},{title:"インライン画像",type:"img"}];(0,t.registerFormatType)("pochipp/inline-tools",{title:"pochippインラインツール",tagName:"pochipp-inline-tools",className:null,edit:r=>{const{value:c,onChange:i,contentRef:p}=r,[a,l]=(0,e.useState)(!1),[s,m]=(0,e.useState)(b[0].type),u=(0,t.useAnchorRef)({ref:p,value:c});return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(o.BlockControls,{group:"other"},(0,e.createElement)(n.DropdownMenu,{icon:"pets",label:"Pochippインラインツール"},(({onClose:t})=>(0,e.createElement)(n.MenuGroup,null,b.map((o=>(0,e.createElement)(n.MenuItem,{key:o.type,icon:"pets",iconPosition:"left",onClick:()=>{var e;e=o.type,m(e),l(!0),t()}},o.title))))))),a&&(0,e.createElement)(f,{selectedType:s,value:c,anchorRef:u,onChange:i,closePopover:()=>l(!1)}))}})})();