!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=17)}([function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t,n){var r=n(6),i=n(0);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?i(e):t}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var r=n(7);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},,,,,,,,,,function(e,t,n){"use strict";n.r(t);var r=n(1),i=n.n(r),a=n(2),o=n.n(a),s=n(3),l=n.n(s),u=n(4),c=n.n(u),p=n(0),g=n.n(p),f=n(5),y=n.n(f),d=function(e){function t(e){var n;return i()(this,t),(n=l()(this,c()(t).call(this,e))).renderDeactivatePluginOption=n.renderDeactivatePluginOption.bind(g()(n)),n.renderProgressBar=n.renderProgressBar.bind(g()(n)),n.renderLog=n.renderLog.bind(g()(n)),n.deactivateBylines=n.deactivateBylines.bind(g()(n)),n.startMigration=n.startMigration.bind(g()(n)),n.clickStart=n.clickStart.bind(g()(n)),n.reset=n.reset.bind(g()(n)),n.migrateChunkOfData=n.migrateChunkOfData.bind(g()(n)),n.getBylinesMigrationInitialData=n.getBylinesMigrationInitialData.bind(g()(n)),n.state={totalToMigrate:0,totalMigrated:0,inProgress:!1,chunkSize:n.props.chunkSize,progress:0,log:"",showDeactivateOption:!1,disablingBylines:!1},n}return y()(t,e),o()(t,[{key:"clickStart",value:function(e){e.preventDefault(),this.startMigration()}},{key:"getBylinesMigrationInitialData",value:function(e){var t=this;this.setState({log:ppmaBylinesMigration.start_message}),window.setTimeout((function(){jQuery.ajax({type:"GET",dataType:"json",url:ajaxurl,async:!1,data:{action:"get_bylines_migration_data",nonce:this.props.nonce},success:function(n){return n.success?(t.setState({totalToMigrate:n.total}),void e()):void t.setState({progress:0,inProgress:!1,log:ppmaBylinesMigration.error_message+n.error,showDeactivateOption:!1})},error:function(e,n,r){t.setState({progress:0,inProgress:!1,log:ppmaBylinesMigration.error_message+r+" ["+n+"]",showDeactivateOption:!1})}})}),1e3)}},{key:"migrateChunkOfData",value:function(){var e=this;jQuery.ajax({type:"GET",dataType:"json",url:ajaxurl,data:{action:"migrate_bylines",nonce:this.props.nonce,chunkSize:this.state.chunkSize},success:function(t){if(t.success){var n=e.state.totalMigrated+e.state.chunkSize;if(n>e.state.totalToMigrate&&(n=e.state.totalToMigrate),e.setState({totalMigrated:n,progress:2+Math.floor(98/e.state.totalToMigrate*n)}),n<e.state.totalToMigrate)e.migrateChunkOfData();else{var r=ppmaBylinesMigration.completed_message;e.setState({progress:100,log:r,showDeactivateOption:!0}),window.setTimeout((function(){e.setState({inProgress:!1})}),1e3)}}else e.setState({progress:0,inProgress:!1,log:ppmaBylinesMigration.error_message+t.error,showDeactivateOption:!1})},error:function(t,n,r){e.setState({progress:0,inProgress:!1,log:ppmaBylinesMigration.error_message+r+" ["+n+"]",showDeactivateOption:!1})}})}},{key:"startMigration",value:function(){var e=this;this.setState({progress:1,inProgress:!0,log:ppmaBylinesMigration.wait_message,showDeactivateOption:!1}),window.setTimeout((function(){e.getBylinesMigrationInitialData((function(){e.setState({progress:2,log:ppmaBylinesMigration.progress_message}),e.migrateChunkOfData()}))}),1e3)}},{key:"deactivateBylines",value:function(){var e=this;this.setState({disablingBylines:!0,log:ppmaBylinesMigration.deactivating_message}),jQuery.ajax({type:"GET",dataType:"json",url:ajaxurl,data:{action:"deactivate_bylines",nonce:this.props.nonce},success:function(){e.setState({disablingBylines:!1,log:ppmaBylinesMigration.deactivated_message,showDeactivateOption:!1})},error:function(t,n,r){e.setState({disablingBylines:!1,log:ppmaBylinesMigration.error_message+r+" ["+n+"]"})}})}},{key:"renderDeactivatePluginOption",value:function(){var e=ppmaBylinesMigration.deactivate_message,t=!this.state.disablingBylines;return wp.element.createElement(m,{label:e,onClick:this.deactivateBylines,enabled:t})}},{key:"reset",value:function(){this.setState({progress:0,inProgress:!1})}},{key:"renderProgressBar",value:function(){return wp.element.createElement(v,{value:this.state.progress})}},{key:"renderLog",value:function(){return wp.element.createElement(h,{log:this.state.log,show:this.state.showDeactivateOption})}},{key:"render",value:function(){var e=!this.state.inProgress,t=this.state.inProgress?this.renderProgressBar():"",n=""==this.state.log?"":this.renderLog(),r=this.state.showDeactivateOption?this.renderDeactivatePluginOption():"";return wp.element.createElement("div",null,wp.element.createElement(m,{label:ppmaBylinesMigration.copy_message,onClick:this.startMigration,enabled:e}),r,t,n)}}]),t}(React.Component),m=function(e){function t(e){return i()(this,t),l()(this,c()(t).call(this,e))}return y()(t,e),o()(t,[{key:"render",value:function(){var e=!this.props.enabled;return wp.element.createElement("input",{type:"button",className:"button button-secondary button-danger ppma_maintenance_button",onClick:this.props.onClick,disabled:e,value:this.props.label})}}]),t}(React.Component),h=function(e){function t(e){return i()(this,t),l()(this,c()(t).call(this,e))}return y()(t,e),o()(t,[{key:"render",value:function(){return wp.element.createElement("div",null,wp.element.createElement("div",{class:"ppma_maintenance_log",readOnly:!0},this.props.log))}}]),t}(React.Component),v=function(e){function t(e){return i()(this,t),l()(this,c()(t).call(this,e))}return y()(t,e),o()(t,[{key:"renderLabel",value:function(){return wp.element.createElement("div",{className:"p-progressbar-label"},this.props.value," %")}},{key:"render",value:function(){var e=this.renderLabel();return wp.element.createElement("div",{role:"progressbar",id:this.props.id,className:"p-progressbar p-component p-progressbar-determinate",style:this.props.style,"aria-valuemin":"0","aria-valuenow":this.props.value,"aria-valuemax":"100","aria-label":this.props.value},wp.element.createElement("div",{className:"p-progressbar-value p-progressbar-value-animate",style:{width:this.props.value+"%",display:"block"}}),e)}}]),t}(React.Component);jQuery((function(){ReactDOM.render(wp.element.createElement(d,{notMigratedPostsId:ppmaBylinesMigration.notMigratedPostsId,nonce:ppmaBylinesMigration.nonce,chunkSize:5}),document.getElementById("publishpress-authors-bylines-migration"))}))}]);