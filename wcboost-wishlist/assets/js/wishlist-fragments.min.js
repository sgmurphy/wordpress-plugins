jQuery(function(a){if(typeof wcboost_wishlist_fragments_params==="undefined"){return false}var r=true,o=wcboost_wishlist_fragments_params.hash_name;try{r="sessionStorage"in window&&window.sessionStorage!==null;window.sessionStorage.setItem("wcboost","test");window.sessionStorage.removeItem("wcboost");window.localStorage.setItem("wcboost","test");window.localStorage.removeItem("wcboost")}catch(t){r=false}var t=function(){this.updateFragments=this.updateFragments.bind(this);this.getProductIds=this.getProductIds.bind(this);a(document.body).on("wishlist_fragments_refresh wishlist_updated",{wishlistFragmentsHandler:this},this.refreshFragments).on("wishlist_fragments_refreshed wishlist_item_added wishlist_item_removed",{wishlistFragmentsHandler:this},this.updateStorage).on("added_to_wishlist removed_from_wishlist",{wishlistFragmentsHandler:this},this.updateFragmentsOnChanges).on("wishlist_storage_updated",{wishlistFragmentsHandler:this},this.updateButtons);a(window).on("storage onstorage",function(t){if("wcboost_wishlist_updated"===t.originalEvent.key){a(document.body).trigger("wishlist_fragments_refresh",[false,{preventStorageUpdate:true}])}});if("yes"===wcboost_wishlist_fragments_params.refresh_on_load){a(document.body).trigger("wishlist_fragments_refresh")}else{a(window).on("pageshow",function(t){if(t.originalEvent.persisted){a(document.body).trigger("wishlist_fragments_refresh",[true])}});try{var t=sessionStorage.getItem(o);if(t!==null){this.updateFragmentsFromStorage();this.updateButtons()}else{this.refreshFragments()}}catch(t){this.refreshFragments()}}};t.prototype.refreshFragments=function(t,s,e){var i=t?t.data.wishlistFragmentsHandler:this;var r={time:(new Date).getTime()};if("yes"===wcboost_wishlist_fragments_params.refresh_on_load||s){r.product_ids=i.getProductIds()}a.post({url:woocommerce_params.wc_ajax_url.toString().replace("%%endpoint%%","get_wishlist_fragments"),data:r,dataType:"json",timeout:wcboost_wishlist_fragments_params.request_timeout,success:function(t){if(!t.success){a(document.body).trigger("wishlist_fragments_failed");return}i.updateFragments(t.data.fragments);a(document.body).trigger("wishlist_fragments_refreshed",[t.data,e])},error:function(){a(document.body).trigger("wishlish_fragments_ajax_error")}})};t.prototype.getProductIds=function(){var e=[];a(".wcboost-wishlist-button").each(function(t,s){e.push(s.dataset.product_id)});return e};t.prototype.updateFragmentsOnChanges=function(t,s,e){var i=t.data.wishlistFragmentsHandler;i.updateFragments(e);if(!s&&!r){i.refreshFragments(t,true)}};t.prototype.updateFragmentsFromStorage=function(){if(!r){return}var t=sessionStorage.getItem(o);if(!t){return}var s=JSON.parse(sessionStorage.getItem("wcboost_wishlist_fragments_"+t));if(s!==null){this.updateFragments(s)}else{this.refreshFragments()}};t.prototype.updateStorage=function(t,s,e){if(!r){return}var i=s.wishlist_hash?s.wishlist_hash:"";sessionStorage.setItem(o,i);if(!e||!e.preventStorageUpdate){localStorage.setItem("wcboost_wishlist_updated",(new Date).getTime())}if(i!==""){if(s.wishlist_items){sessionStorage.setItem("wcboost_wishlist_"+i,JSON.stringify(s.wishlist_items))}if(s.fragments){sessionStorage.setItem("wcboost_wishlist_fragments_"+i,JSON.stringify(s.fragments))}a(document.body).trigger("wishlist_storage_updated")}};t.prototype.updateFragments=function(t){a.each(t,function(t,s){a(t).replaceWith(s)});a(document.body).trigger("wishlist_fragments_loaded")};t.prototype.updateButtons=function(t){if(!r){return}var s=sessionStorage.getItem(o);if(!s){return}var e=JSON.parse(sessionStorage.getItem("wcboost_wishlist_"+s));if(e===null){return}var i=t?t.data.wishlistFragmentsHandler:this;a(".wcboost-wishlist-button").each(function(){var t=this.dataset.product_id,s=e[t]?e[t]:null;i.updateButtonStatus(this,s);if(this.dataset.variations){i.updateButtonVariations(this,e)}})};t.prototype.updateButtonStatus=function(t,s){var e=a(t);if(!e.length){return}if(s){if(e.hasClass("added")){return}e.removeClass("loading").addClass("added");switch(wcboost_wishlist_params.exists_item_behavior){case"view_wishlist":e.attr("href",s.wishlist_url?s.wishlist_url:wcboost_wishlist_params.wishlist_url);e.find(".wcboost-wishlist-button__text").text(wcboost_wishlist_params.i18n_view_wishlist);e.find(".wcboost-wishlist-button__icon").html(wcboost_wishlist_params.icon_filled);break;case"remove":e.attr("href",s.remove_url);e.find(".wcboost-wishlist-button__text").text(wcboost_wishlist_params.i18n_remove_from_wishlist);e.find(".wcboost-wishlist-button__icon").html(wcboost_wishlist_params.icon_filled);break;case"hide":e.hide();break}}else{if(!e.hasClass("added")&&!e.hasClass("loading")){return}e.removeClass("added loading");e.attr("href","?add-to-wishlist="+e.data("product_id"));e.find(".wcboost-wishlist-button__text").text(wcboost_wishlist_params.i18n_add_to_wishlist);e.find(".wcboost-wishlist-button__icon").html(wcboost_wishlist_params.icon_normal)}};t.prototype.updateButtonVariations=function(t,s){var e=a(t);if(!e.length||!e.data("variations")){return}var i=e.data("variations");for(var r in i){i[r]=a.extend({},i[r],{added:s[i[r].variation_id]===undefined?"no":"yes"})}e.data("variations",i)};new t});